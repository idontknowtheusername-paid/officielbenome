import{j as s}from"./ui-bmbdwy1o.js";import{r as e}from"./router-Bph3fafD.js";import{ax as a,ay as r,az as t,D as i,B as n,R as c,aB as l,s as o,a_ as m,N as u,y as d}from"./admin-De95lozH.js";import{u as g}from"./messaging-DrPLMxma.js";import"./vendor-ColW0ZSm.js";import"./animations-DSMsGdv3.js";import"./query-Bi6RA_hy.js";import"./utils-iFD8Ag1C.js";import"./charts-HAerfkS9.js";import"./forms-C0k40EqE.js";import"./supabase-Dq2SgcTS.js";import"./services-BPp_p-AO.js";import"./maps-DRfFuCRj.js";const x=()=>{const{user:x,session:h}=g(),[j,p]=e.useState({}),[f,v]=e.useState(!1),N=()=>{return s=function*(){v(!0);const s={};try{const{data:a,error:r}=yield o.from("conversations").select("count").limit(1);s.supabaseConnection={status:r?"error":"success",message:r?"Erreur: "+r.message:"Connexion OK",details:r},s.authentication={status:x?"success":"error",message:x?"Utilisateur connecté: "+x.email:"Aucun utilisateur connecté",details:{user:x,session:h}};const t="https://vvlpgviacinsbggfsexs.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ2bHBndmlhY2luc2JnZ2ZzZXhzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ1MjMzNjUsImV4cCI6MjA3MDA5OTM2NX0.YsZUDyYfgGHD7jNDKAVaR4Y0yzulwLo2NGo85ohHefY";if(s.environment={status:t&&i?"success":"error",message:t&&i?"Variables configurées":"Variables manquantes",details:{url:t?"✅ Configurée":"❌ Manquante",key:i?"✅ Configurée":"❌ Manquante"}},x)try{const{data:e,error:a}=yield o.from("conversations").select("*").or(`participant1_id.eq.${x.id},participant2_id.eq.${x.id}`).limit(5);s.conversations={status:a?"error":"success",message:a?"Erreur: "+a.message:((null==e?void 0:e.length)||0)+" conversations trouvées",details:a}}catch(e){s.conversations={status:"error",message:"Erreur: "+e.message,details:e}}if(x)try{const{data:e,error:a}=yield o.from("messages").select("*").or(`sender_id.eq.${x.id},receiver_id.eq.${x.id}`).limit(5);s.messages={status:a?"error":"success",message:a?"Erreur: "+a.message:((null==e?void 0:e.length)||0)+" messages trouvés",details:a}}catch(e){s.messages={status:"error",message:"Erreur: "+e.message,details:e}}}catch(e){s.general={status:"error",message:"Erreur générale: "+e.message,details:e}}p(s),v(!1)},new Promise(((e,a)=>{var r=e=>{try{i(s.next(e))}catch(r){a(r)}},t=e=>{try{i(s.throw(e))}catch(r){a(r)}},i=s=>s.done?e(s.value):Promise.resolve(s.value).then(r,t);i((s=s.apply(null,null)).next())}));var s};e.useEffect((()=>{N()}),[x]);const y=e=>{switch(e){case"success":return s.jsx(u,{className:"h-4 w-4 text-green-500"});case"error":return s.jsx(m,{className:"h-4 w-4 text-red-500"});default:return s.jsx(i,{className:"h-4 w-4 text-yellow-500"})}},b=e=>{switch(e){case"success":return s.jsx(d,{variant:"default",className:"bg-green-500",children:"OK"});case"error":return s.jsx(d,{variant:"destructive",children:"ERREUR"});default:return s.jsx(d,{variant:"secondary",children:"WARNING"})}};return s.jsx("div",{className:"p-6 max-w-4xl mx-auto",children:s.jsxs(a,{children:[s.jsxs(r,{children:[s.jsxs(t,{className:"flex items-center gap-2",children:[s.jsx(i,{className:"h-5 w-5"}),"Diagnostic Interface Messagerie"]}),s.jsx(n,{onClick:N,disabled:f,className:"w-fit",children:f?s.jsxs(s.Fragment,{children:[s.jsx(c,{className:"h-4 w-4 mr-2 animate-spin"}),"Diagnostic en cours..."]}):s.jsxs(s.Fragment,{children:[s.jsx(c,{className:"h-4 w-4 mr-2"}),"Relancer le diagnostic"]})})]}),s.jsx(l,{className:"space-y-4",children:Object.entries(j).map((([e,a])=>s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h3",{className:"font-medium capitalize",children:e.replace(/([A-Z])/g," $1")}),s.jsxs("div",{className:"flex items-center gap-2",children:[y(a.status),b(a.status)]})]}),s.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:a.message}),a.details&&s.jsxs("details",{className:"text-xs",children:[s.jsx("summary",{className:"cursor-pointer text-muted-foreground",children:"Détails techniques"}),s.jsx("pre",{className:"mt-2 p-2 bg-muted rounded text-xs overflow-auto",children:JSON.stringify(a.details,null,2)})]})]},e)))})]})})},h=()=>s.jsx("div",{className:"min-h-screen bg-background",children:s.jsx(x,{})});export{h as default};
