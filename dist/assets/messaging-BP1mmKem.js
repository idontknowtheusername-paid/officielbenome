var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r={}.hasOwnProperty,i={}.propertyIsEnumerable,n=Math.pow,l=(s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,o=(e,s)=>{for(var t in s||(s={}))r.call(s,t)&&l(e,t,s[t]);if(a)for(var t of a(s))i.call(s,t)&&l(e,t,s[t]);return e},c=(e,a)=>s(e,t(a)),d=(e,s)=>{var t={};for(var n in e)r.call(e,n)&&0>s.indexOf(n)&&(t[n]=e[n]);if(null!=e&&a)for(var n of a(e))0>s.indexOf(n)&&i.call(e,n)&&(t[n]=e[n]);return t},m=(e,s,t)=>new Promise(((a,r)=>{var i=e=>{try{l(t.next(e))}catch(s){r(s)}},n=e=>{try{l(t.throw(e))}catch(s){r(s)}},l=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,n);l((t=t.apply(e,s)).next())}));import{j as u,a3 as h,a4 as x,a5 as p,a6 as f,a7 as g,a8 as v,a9 as j,aa as b,ab as N,ac as y,S as w,ad as C,ae as S,af as k,ag as z,ah as A,ai as E,aj as R,ak as L,al as I}from"./ui-BkW4XaSf.js";import{r as D,R as _,c as T}from"./router-g3RhsYON.js";import{c as P,C as $,a as M,T as O,S as F,R as U,b as V,A as q,d as B,e as G,f as H,g as W,h as K,i as Q,j as Z,B as J,L as Y,k as X,E as ee,l as se,X as te,U as ae,u as re,s as ie,m as ne,P as le,V as oe,n as ce,o as de,p as me,F as ue,M as he,I as xe,q as pe,r as fe,t as ge,H as ve,v as je,w as be,x as Ne,y as ye,z as we,D as Ce,G as Se,J as ke,K as ze,N as Ae,O as Ee,Q as Re,W as Le,Y as Ie,Z as De,_ as _e,$ as Te,a0 as Pe,a1 as $e,a2 as Me,a3 as Oe,a4 as Fe,a5 as Ue,a6 as Ve,a7 as qe,a8 as Be,a9 as Ge,aa as He,ab as We,ac as Ke,ad as Qe,ae as Ze}from"./admin-xTumA9HW.js";import{u as Je,f as Ye,g as Xe,h as es}from"./forms-CVlSZARz.js";import{a as ss,l as ts}from"./services-CqmL7Hwe.js";import{a as as,u as rs,Q as is,c as ns,b as ls}from"./query-BZBOCxXK.js";import{A as os,m as cs}from"./animations-B7Vm-81o.js";import{L as ds}from"./maps-DILUY6PO.js";import{g as ms}from"./vendor-DaBoii6j.js";import{a as us}from"./utils-iFD8Ag1C.js";function hs(){return D.useEffect((()=>{if("undefined"!=typeof document){let e=document.getElementById("toaster-container");e||(e=document.createElement("div"),e.id="toaster-container",e.className="fixed top-0 right-0 z-[100] p-4 space-y-2 pointer-events-none",document.body.appendChild(e))}}),[]),u.jsx("div",{id:"toaster-container",className:"fixed top-0 right-0 z-[100] p-4 space-y-2 pointer-events-none"})}const xs=us("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",success:"border-green-500/50 text-green-600 dark:border-green-500 [&>svg]:text-green-600",warning:"border-yellow-500/50 text-yellow-600 dark:border-yellow-500 [&>svg]:text-yellow-600",info:"border-blue-500/50 text-blue-600 dark:border-blue-500 [&>svg]:text-blue-600"}},defaultVariants:{variant:"default"}}),ps=D.forwardRef(((e,s)=>{var t=e,{className:a,variant:r}=t,i=d(t,["className","variant"]);return u.jsx("div",o({ref:s,role:"alert",className:P(xs({variant:r}),a)},i))}));ps.displayName="Alert";const fs=D.forwardRef(((e,s)=>{var t=e,{className:a}=t,r=d(t,["className"]);return u.jsx("h5",o({ref:s,className:P("mb-1 font-medium leading-none tracking-tight",a)},r))}));fs.displayName="AlertTitle";const gs=D.forwardRef(((e,s)=>{var t=e,{className:a}=t,r=d(t,["className"]);return u.jsx("div",o({ref:s,className:P("text-sm [&_p]:leading-relaxed",a)},r))}));gs.displayName="AlertDescription";const vs=D.forwardRef(((e,s)=>{var t=e,{className:a}=t,r=d(t,["className"]);return u.jsx(h,c(o({ref:s,className:P("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a)},r),{children:u.jsx(x,{className:P("flex items-center justify-center text-current"),children:u.jsx($,{className:"h-4 w-4"})})}))}));vs.displayName=h.displayName;const js=j,bs=_.forwardRef(((e,s)=>{var t=e,{className:a}=t,r=d(t,["className"]);return u.jsx(p,o({ref:s,className:P("border-b border-border",a)},r))}));bs.displayName="AccordionItem";const Ns=_.forwardRef(((e,s)=>{var t=e,{className:a,children:r}=t,i=d(t,["className","children"]);return u.jsx(f,{className:"flex",children:u.jsxs(g,c(o({ref:s,className:P("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline text-foreground [&[data-state=open]>svg]:rotate-180",a)},i),{children:[r,u.jsx(M,{className:"h-4 w-4 shrink-0 transition-transform duration-200 text-muted-foreground"})]}))})}));Ns.displayName=g.displayName;const ys=_.forwardRef(((e,s)=>{var t=e,{className:a,children:r}=t,i=d(t,["className","children"]);return u.jsx(v,c(o({ref:s,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"},i),{children:u.jsx("div",{className:P("pb-4 pt-0 text-muted-foreground",a),children:r})}))}));ys.displayName=v.displayName;const ws=_.forwardRef(((e,s)=>{var t=e,{className:a}=t,r=d(t,["className"]);return u.jsx(b,o({ref:s,className:P("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a)},r))}));ws.displayName=b.displayName;const Cs=_.forwardRef(((e,s)=>{var t=e,{className:a}=t,r=d(t,["className"]);return u.jsx(N,o({ref:s,className:P("aspect-square h-full w-full",a)},r))}));Cs.displayName=N.displayName;const Ss=_.forwardRef(((e,s)=>{var t=e,{className:a}=t,r=d(t,["className"]);return u.jsx(y,o({ref:s,className:P("flex h-full w-full items-center justify-center rounded-full bg-muted",a)},r))}));Ss.displayName=y.displayName;const ks=({isOpen:e,onClose:s,onConfirm:t,title:a,description:r,confirmText:i="Confirmer",cancelText:n="Annuler",variant:l="destructive",icon:o=H,isLoading:c=!1})=>u.jsx(q,{open:e,onOpenChange:s,children:u.jsxs(B,{children:[u.jsxs(G,{children:[u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx(o,{className:"h-6 w-6 "+(()=>{switch(l){case"destructive":return"text-red-500";case"warning":return"text-yellow-500";case"info":return"text-blue-500";default:return"text-gray-500"}})()}),u.jsx(W,{children:a})]}),u.jsx(K,{className:"text-left",children:r})]}),u.jsxs(Q,{children:[u.jsx(Z,{disabled:c,children:n}),u.jsxs(J,{variant:(()=>{switch(l){case"destructive":return"destructive";case"warning":return"secondary";case"info":return"default";default:return"outline"}})(),onClick:t,disabled:c,className:"flex items-center space-x-2",children:[c&&u.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),u.jsx("span",{children:i})]})]})]})}),zs=({isOpen:e,onClose:s,onConfirm:t,itemName:a,isLoading:r})=>u.jsx(ks,{isOpen:e,onClose:s,onConfirm:t,title:"Confirmer la suppression",description:`Êtes-vous sûr de vouloir supprimer "${a}" ? Cette action est irréversible.`,confirmText:"Supprimer",variant:"destructive",icon:O,isLoading:r}),As=({isOpen:e,onClose:s,onConfirm:t,itemName:a,isLoading:r})=>u.jsx(ks,{isOpen:e,onClose:s,onConfirm:t,title:"Modifier l'élément",description:`Voulez-vous modifier "${a}" ?`,confirmText:"Modifier",variant:"info",icon:F,isLoading:r}),Es=({isOpen:e,onClose:s,onConfirm:t,itemName:a,isLoading:r})=>u.jsx(ks,{isOpen:e,onClose:s,onConfirm:t,title:"Actualiser l'élément",description:`Voulez-vous actualiser "${a}" ? Cela remettra l'élément en haut de la liste.`,confirmText:"Actualiser",variant:"info",icon:U,isLoading:r}),Rs=({isOpen:e,onClose:s,onConfirm:t,itemName:a,isLoading:r})=>u.jsx(ks,{isOpen:e,onClose:s,onConfirm:t,title:"Booster l'élément",description:`Voulez-vous booster "${a}" ? Cela augmentera sa visibilité.`,confirmText:"Booster",variant:"warning",icon:V,isLoading:r}),Ls=D.createContext({}),Is=()=>{const e=D.useContext(Ls),s=D.useContext(Ds),{getFieldState:t,formState:a}=Je(),r=t(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");const{id:i}=s;return o({id:i,name:e.name,formItemId:i+"-form-item",formDescriptionId:i+"-form-item-description",formMessageId:i+"-form-item-message"},r)},Ds=D.createContext({});D.forwardRef(((e,s)=>{var t=e,{className:a}=t,r=d(t,["className"]);const i=D.useId();return u.jsx(Ds.Provider,{value:{id:i},children:u.jsx("div",o({ref:s,className:P("space-y-2",a)},r))})})).displayName="FormItem",D.forwardRef(((e,s)=>{var t=e,{className:a}=t,r=d(t,["className"]);const{error:i,formItemId:n}=Is();return u.jsx(Y,o({ref:s,className:P(i&&"text-destructive",a),htmlFor:n},r))})).displayName="FormLabel",D.forwardRef(((e,s)=>{var t=d(e,[]);const{error:a,formItemId:r,formDescriptionId:i,formMessageId:n}=Is();return u.jsx(w,o({ref:s,id:r,"aria-describedby":a?`${i} ${n}`:""+i,"aria-invalid":!!a},t))})).displayName="FormControl",D.forwardRef(((e,s)=>{var t=e,{className:a}=t,r=d(t,["className"]);const{formDescriptionId:i}=Is();return u.jsx("p",o({ref:s,id:i,className:P("text-sm text-muted-foreground",a)},r))})).displayName="FormDescription",D.forwardRef(((e,s)=>{var t=e,{className:a,children:r}=t,i=d(t,["className","children"]);const{error:n,formMessageId:l}=Is(),m=n?(null==n?void 0:n.message)+"":r;return m?u.jsx("p",c(o({ref:s,id:l,className:P("text-sm font-medium text-destructive",a)},i),{children:m})):null})).displayName="FormMessage",_.forwardRef(((e,s)=>{var t=e,{className:a,align:r="center",sideOffset:i=4}=t,n=d(t,["className","align","sideOffset"]);return u.jsx(C,o({ref:s,align:r,sideOffset:i,className:P("z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a)},n))})).displayName=C.displayName,D.forwardRef(((e,s)=>{var t=e,{className:a,align:r="center",sideOffset:i=4}=t,n=d(t,["className","align","sideOffset"]);return u.jsx(S,{children:u.jsx(k,o({ref:s,align:r,sideOffset:i,className:P("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a)},n))})})).displayName=k.displayName;const _s=({currentPage:e,totalPages:s,onPageChange:t,hasNextPage:a,hasPrevPage:r,isLoading:i=!1})=>s>1?u.jsxs("div",{className:"flex items-center justify-center space-x-2 py-4",children:[u.jsxs(J,{variant:"outline",size:"sm",onClick:()=>t(e-1),disabled:!r||i,className:"flex items-center space-x-1",children:[u.jsx(X,{className:"h-4 w-4"}),u.jsx("span",{className:"hidden sm:inline",children:"Précédent"})]}),u.jsx("div",{className:"flex items-center space-x-1",children:(()=>{const t=[],a=[];for(let r=Math.max(2,e-2);Math.min(s-1,e+2)>=r;r++)t.push(r);return e-2>2?a.push(1,"..."):a.push(1),a.push(...t),s-1>e+2?a.push("...",s):a.push(s),a})().map(((s,a)=>u.jsx(_.Fragment,{children:"..."===s?u.jsx(ee,{className:"h-4 w-4 text-muted-foreground"}):u.jsx(J,{variant:e===s?"default":"outline",size:"sm",onClick:()=>t(s),disabled:i,className:"w-8 h-8 p-0",children:s})},a)))}),u.jsxs(J,{variant:"outline",size:"sm",onClick:()=>t(e+1),disabled:!a||i,className:"flex items-center space-x-1",children:[u.jsx("span",{className:"hidden sm:inline",children:"Suivant"}),u.jsx(se,{className:"h-4 w-4"})]})]}):null,Ts=D.forwardRef(((e,s)=>{var t=e,{className:a=""}=t,r=d(t,["className"]);return u.jsx("div",o({className:"grid gap-2 "+a,ref:s},r))}));Ts.displayName="RadioGroup";const Ps=D.forwardRef(((e,s)=>{var t=e,{className:a=""}=t,r=d(t,["className"]);return u.jsx("input",o({type:"radio",className:"h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 "+a,ref:s},r))}));Ps.displayName="RadioGroupItem";const $s=e=>{var s=e,{className:t}=s,a=d(s,["className"]);return u.jsx("div",o({className:P("animate-pulse rounded-md bg-muted",t)},a))},Ms=()=>u.jsxs("div",{className:"bg-card rounded-lg shadow-lg overflow-hidden",children:[u.jsx($s,{className:"h-48 w-full"}),u.jsxs("div",{className:"p-4 space-y-3",children:[u.jsx($s,{className:"h-4 w-3/4"}),u.jsx($s,{className:"h-4 w-1/2"}),u.jsx($s,{className:"h-6 w-1/3"}),u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx($s,{className:"h-4 w-20"}),u.jsx($s,{className:"h-8 w-20 rounded"})]})]})]}),Os=()=>u.jsxs("div",{className:"bg-card rounded-lg p-6 space-y-3",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx($s,{className:"h-4 w-1/2"}),u.jsx($s,{className:"h-8 w-8 rounded"})]}),u.jsx($s,{className:"h-8 w-1/3"}),u.jsx($s,{className:"h-3 w-2/3"})]});_.forwardRef(((e,s)=>{var t=e,{className:a}=t,r=d(t,["className"]);return u.jsx(z,o({ref:s,className:P("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",a)},r))})).displayName=z.displayName;const Fs=us("data-[swipe=move]:transition-none group relative pointer-events-auto flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full data-[state=closed]:slide-out-to-right-full",{variants:{variant:{default:"bg-background border",destructive:"group destructive border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}});_.forwardRef(((e,s)=>{var t=e,{className:a,variant:r}=t,i=d(t,["className","variant"]);return u.jsx(A,o({ref:s,className:P(Fs({variant:r}),a)},i))})).displayName=A.displayName,_.forwardRef(((e,s)=>{var t=e,{className:a}=t,r=d(t,["className"]);return u.jsx(E,o({ref:s,className:P("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-destructive/30 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",a)},r))})).displayName=E.displayName,_.forwardRef(((e,s)=>{var t=e,{className:a}=t,r=d(t,["className"]);return u.jsx(R,c(o({ref:s,className:P("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",a),"toast-close":""},r),{children:u.jsx(te,{className:"h-4 w-4"})}))})).displayName=R.displayName,_.forwardRef(((e,s)=>{var t=e,{className:a}=t,r=d(t,["className"]);return u.jsx(L,o({ref:s,className:P("text-sm font-semibold",a)},r))})).displayName=L.displayName,_.forwardRef(((e,s)=>{var t=e,{className:a}=t,r=d(t,["className"]);return u.jsx(I,o({ref:s,className:P("text-sm opacity-90",a)},r))})).displayName=I.displayName;const Us=({user:e,size:s="default",className:t,showFallbackIcon:a=!1})=>e?u.jsxs(ws,{className:P((()=>{switch(s){case"sm":return"h-8 w-8";case"lg":return"h-12 w-12";case"xl":return"h-16 w-16";default:return"h-10 w-10"}})(),t),children:[e.avatar_url&&u.jsx(Cs,{src:e.avatar_url,alt:`${e.first_name||""} ${e.last_name||""}`,onError:e=>{e.target.style.display="none"}}),u.jsx(Ss,{className:P((()=>{const s=`${e.first_name||""}${e.last_name||""}`.toLowerCase();if(!s)return"bg-gray-500";const t=["bg-blue-500","bg-green-500","bg-purple-500","bg-pink-500","bg-indigo-500","bg-yellow-500","bg-red-500","bg-teal-500"];let a=0;for(let e=0;e<s.length;e++)a=s.charCodeAt(e)+((a<<5)-a);return t[Math.abs(a)%t.length]})(),"text-white font-semibold",(()=>{switch(s){case"sm":return"text-xs";case"lg":return"text-lg";case"xl":return"text-2xl";default:return"text-sm"}})()),children:a?u.jsx(ae,{className:P("sm"===s&&"h-3 w-3","default"===s&&"h-4 w-4","lg"===s&&"h-5 w-5","xl"===s&&"h-6 w-6")}):(()=>{const s=e.first_name||"",t=e.last_name||"";return s&&t?`${s.charAt(0)}${t.charAt(0)}`.toUpperCase():s?s.charAt(0).toUpperCase():t?t.charAt(0).toUpperCase():e.email?e.email.charAt(0).toUpperCase():"?"})()})]}):u.jsx(ws,{className:P("bg-gray-200","sm"===s&&"h-8 w-8","default"===s&&"h-10 w-10","lg"===s&&"h-12 w-12","xl"===s&&"h-16 w-16",t),children:u.jsx(Ss,{className:"bg-gray-200 text-gray-600",children:u.jsx(ae,{className:"h-4 w-4"})})});var Vs=function(e,s){for(var t={};e.length;){var a=e[0],r=a.code,i=a.message,n=a.path.join(".");if(!t[n])if("unionErrors"in a){var l=a.unionErrors[0].errors[0];t[n]={message:l.message,type:l.code}}else t[n]={message:i,type:r};if("unionErrors"in a&&a.unionErrors.forEach((function(s){return s.errors.forEach((function(s){return e.push(s)}))})),s){var o=t[n].types,c=o&&o[a.code];t[n]=es(n,s,t,r,c?[].concat(c,a.message):a.message)}e.shift()}return t},qs=function(e,s,t){return void 0===t&&(t={}),function(a,r,i){try{return Promise.resolve(function(r,n){try{var l=Promise.resolve(e["sync"===t.mode?"parse":"parseAsync"](a,s)).then((function(e){return i.shouldUseNativeValidation&&Ye({},i),{errors:{},values:t.raw?a:e}}))}catch(o){return n(o)}return l&&l.then?l.then(void 0,n):l}(0,(function(e){if(Array.isArray(null==(s=e)?void 0:s.errors))return{values:{},errors:Xe(Vs(e.errors,!i.shouldUseNativeValidation&&"all"===i.criteriaMode),i)};var s;throw e})))}catch(n){return Promise.reject(n)}}};const Bs=({size:e="default",showName:s=!1,showStatus:t=!1,className:a=""})=>u.jsxs("div",{className:"aida-profile "+a,children:[u.jsxs("div",{className:"profile-container "+{sm:"w-8 h-8",default:"w-10 h-10",lg:"w-12 h-12",xl:"w-16 h-16"}[e],children:[u.jsxs("div",{className:"profile-background",children:[u.jsx("div",{className:"gradient-overlay"}),u.jsx("div",{className:"geometric-pattern"})]}),u.jsxs("div",{className:"aida-logo",children:[u.jsx("div",{className:"logo-circle",children:u.jsx("span",{className:"logo-text",children:"A"})}),u.jsx("div",{className:"logo-accent"})]}),t&&u.jsx("div",{className:"status-indicator",children:u.jsx("div",{className:"status-dot"})}),u.jsx("div",{className:"shine-effect"})]}),s&&u.jsxs("div",{className:"profile-info",children:[u.jsx("div",{className:"profile-name "+{sm:"text-xs",default:"text-sm",lg:"text-base",xl:"text-lg"}[e],children:"AIDA"}),u.jsx("div",{className:"profile-description",children:"Assistant Intelligent"})]}),u.jsx("style",{jsx:!0,children:"\n        .aida-profile {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        }\n        \n        .profile-container {\n          position: relative;\n          border-radius: 50%;\n          overflow: hidden;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);\n        }\n        \n        .profile-background {\n          position: absolute;\n          inset: 0;\n          background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);\n        }\n        \n        .gradient-overlay {\n          position: absolute;\n          inset: 0;\n          background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);\n        }\n        \n        .geometric-pattern {\n          position: absolute;\n          inset: 0;\n          background-image: \n            radial-gradient(circle at 20% 20%, rgba(255,255,255,0.1) 2px, transparent 2px),\n            radial-gradient(circle at 80% 80%, rgba(255,255,255,0.1) 2px, transparent 2px);\n          background-size: 100% 100%;\n        }\n        \n        .aida-logo {\n          position: relative;\n          z-index: 2;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        }\n        \n        .logo-circle {\n          width: 60%;\n          height: 60%;\n          border-radius: 50%;\n          background: rgba(255, 255, 255, 0.95);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n        }\n        \n        .logo-text {\n          font-weight: 700;\n          color: #1d4ed8;\n          font-size: 0.8em;\n          letter-spacing: -0.5px;\n        }\n        \n        .logo-accent {\n          position: absolute;\n          top: -2px;\n          right: -2px;\n          width: 8px;\n          height: 8px;\n          border-radius: 50%;\n          background: #0ea5e9;\n          border: 2px solid rgba(255, 255, 255, 0.9);\n        }\n        \n        .status-indicator {\n          position: absolute;\n          bottom: 2px;\n          right: 2px;\n          z-index: 3;\n        }\n        \n        .status-dot {\n          width: 8px;\n          height: 8px;\n          border-radius: 50%;\n          background: #10b981;\n          border: 2px solid rgba(255, 255, 255, 0.9);\n          animation: pulse 2s infinite;\n        }\n        \n        .shine-effect {\n          position: absolute;\n          top: 0;\n          left: -100%;\n          width: 100%;\n          height: 100%;\n          background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);\n          animation: shine 3s infinite;\n        }\n        \n        .profile-info {\n          display: flex;\n          flex-direction: column;\n          gap: 2px;\n        }\n        \n        .profile-name {\n          font-weight: 600;\n          color: #1f2937;\n          line-height: 1;\n        }\n        \n        .profile-description {\n          font-size: 0.75em;\n          color: #6b7280;\n          line-height: 1;\n        }\n        \n        @keyframes pulse {\n          0%, 100% {\n            transform: scale(1);\n            opacity: 1;\n          }\n          50% {\n            transform: scale(1.2);\n            opacity: 0.7;\n          }\n        }\n        \n        @keyframes shine {\n          0% {\n            left: -100%;\n          }\n          50% {\n            left: 100%;\n          }\n          100% {\n            left: 100%;\n          }\n        }\n        \n        /* Responsive */\n        @media (max-width: 640px) {\n          .profile-container {\n            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);\n          }\n        }\n      "})]}),Gs=({selectedConversation:e,onBack:s,onMenuToggle:t,onSearch:a,onFilter:r,onMore:i,onCall:n,onVideo:l,unreadCount:o=0,isStarred:c=!1,isArchived:d=!1})=>{var m,h;return e?u.jsxs("div",{className:"bg-card border-b border-border px-4 py-3 flex items-center justify-between",children:[u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx(J,{variant:"ghost",size:"sm",onClick:s,className:"p-2 -ml-2",children:u.jsx(X,{className:"h-5 w-5"})}),u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx("div",{className:"w-8 h-8 bg-muted rounded-full flex items-center justify-center",children:u.jsx(ae,{className:"h-4 w-4 text-muted-foreground"})}),u.jsxs("div",{children:[u.jsx("p",{className:"font-medium text-sm",children:(null==(m=e.participant1)?void 0:m.first_name)||"Utilisateur"}),u.jsx("p",{className:"text-xs text-muted-foreground",children:(null==(h=e.listing)?void 0:h.title)||"Conversation"})]})]})]}),u.jsxs("div",{className:"flex items-center space-x-1",children:[n&&u.jsx(J,{variant:"ghost",size:"sm",onClick:n,className:"p-2",children:u.jsx(le,{className:"h-4 w-4"})}),l&&u.jsx(J,{variant:"ghost",size:"sm",onClick:l,className:"p-2",children:u.jsx(oe,{className:"h-4 w-4"})}),u.jsx(J,{variant:"ghost",size:"sm",onClick:i,className:"p-2",children:u.jsx(ce,{className:"h-4 w-4"})})]})]}):u.jsxs("div",{className:"bg-card border-b border-border px-4 py-3 flex items-center justify-between",children:[u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx("h1",{className:"text-lg font-semibold",children:"Messages"}),o>0&&u.jsx(de,{variant:"destructive",className:"h-5 px-2 text-xs",children:o})]}),u.jsxs("div",{className:"flex items-center space-x-1",children:[u.jsx(J,{variant:"ghost",size:"sm",onClick:a,className:"p-2",children:u.jsx(me,{className:"h-4 w-4"})}),u.jsx(J,{variant:"ghost",size:"sm",onClick:r,className:"p-2",children:u.jsx(ue,{className:"h-4 w-4"})}),u.jsx(J,{variant:"ghost",size:"sm",onClick:t,className:"p-2",children:u.jsx(he,{className:"h-4 w-4"})})]})]})},Hs=({searchTerm:e,onSearchChange:s,filterType:t,onFilterChange:a,onClear:r,totalCount:i=0,unreadCount:n=0,starredCount:l=0,archivedCount:o=0})=>{const[c,d]=D.useState(!1),m=[{key:"all",label:"Toutes",icon:pe,count:i},{key:"unread",label:"Non lues",icon:fe,count:n},{key:"starred",label:"Favoris",icon:V,count:l},{key:"archived",label:"Archivées",icon:ge,count:o}];return u.jsxs("div",{className:"bg-card border-b border-border p-4",children:[u.jsxs("div",{className:"relative mb-3",children:[u.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),u.jsx(xe,{placeholder:"Rechercher des conversations...",value:e,onChange:e=>s(e.target.value),className:"pl-10 pr-10"}),e&&u.jsx(J,{variant:"ghost",size:"sm",onClick:r,className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-1 h-6 w-6",children:u.jsx(te,{className:"h-4 w-4"})})]}),u.jsx("div",{className:"flex space-x-2 mb-3",children:m.map((e=>u.jsxs(J,{variant:t===e.key?"default":"outline",size:"sm",onClick:()=>a(e.key),className:"flex-1 flex items-center justify-center space-x-1",children:[u.jsx(e.icon,{className:"h-3 w-3"}),u.jsx("span",{className:"text-xs",children:e.label}),e.count>0&&u.jsx(de,{variant:"secondary",className:"ml-1 h-4 px-1 text-xs",children:e.count})]},e.key)))}),c&&u.jsx("div",{className:"pt-3 border-t border-border",children:u.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[u.jsxs(J,{variant:"outline",size:"sm",className:"text-xs",children:[u.jsx(ae,{className:"h-3 w-3 mr-1"}),"Par utilisateur"]}),u.jsxs(J,{variant:"outline",size:"sm",className:"text-xs",children:[u.jsx(ve,{className:"h-3 w-3 mr-1"}),"Par annonce"]})]})}),u.jsx("div",{className:"flex justify-center",children:u.jsxs(J,{variant:"ghost",size:"sm",onClick:()=>d(!c),className:"text-xs text-muted-foreground hover:text-foreground",children:[u.jsx(ue,{className:"h-3 w-3 mr-1"}),c?"Masquer":"Plus de filtres"]})})]})},Ws=({onCapture:e,onClose:s,isOpen:t=!1,quality:a=.8,maxWidth:r=1920,maxHeight:i=1080})=>{const n=D.useRef(null),l=D.useRef(null),o=D.useRef(null),[c,d]=D.useState(!1),[h,x]=D.useState(null),[p,f]=D.useState(null),[g,v]=D.useState(null),[j,b]=D.useState(!1),[N,y]=D.useState("user"),{toast:w}=je(),C=D.useCallback((()=>m(null,null,(function*(){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){d(!0),f(null);try{const e={video:{facingMode:N,width:{ideal:r},height:{ideal:i}},audio:!1},s=yield navigator.mediaDevices.getUserMedia(e);o.current=s,n.current&&(n.current.srcObject=s,n.current.onloadedmetadata=()=>{b(!0),d(!1)}),x(!0)}catch(e){"NotAllowedError"===e.name?f("Permission d'accès à la caméra refusée. Veuillez autoriser l'accès dans les paramètres de votre navigateur."):"NotFoundError"===e.name?f("Aucune caméra trouvée sur votre appareil."):"NotReadableError"===e.name?f("La caméra est déjà utilisée par une autre application."):f("Erreur lors de l'accès à la caméra. Veuillez réessayer."),x(!1),d(!1)}}else f("Votre navigateur ne supporte pas l'accès à la caméra")}))),[N,r,i]),S=D.useCallback((()=>{o.current&&(o.current.getTracks().forEach((e=>e.stop())),o.current=null),b(!1)}),[]),k=D.useCallback((()=>{j&&(S(),y((e=>"user"===e?"environment":"user")),setTimeout((()=>C()),100))}),[j,S,C]),z=D.useCallback((()=>{if(!n.current||!l.current)return;const e=n.current,s=l.current,t=s.getContext("2d");s.width=e.videoWidth,s.height=e.videoHeight,t.drawImage(e,0,0,s.width,s.height),s.toBlob((e=>{if(e){const s=URL.createObjectURL(e);v({blob:e,url:s,timestamp:(new Date).toISOString()}),w({title:"Photo capturée !",description:"Votre photo a été capturée avec succès.",duration:3e3})}}),"image/jpeg",a)}),[a,w]),A=D.useCallback((()=>{v(null),(null==g?void 0:g.url)&&URL.revokeObjectURL(g.url)}),[g]),E=D.useCallback((()=>{g&&e&&(e(g),s())}),[g,e,s]),R=D.useCallback((()=>{S(),(null==g?void 0:g.url)&&URL.revokeObjectURL(g.url),v(null),f(null),s()}),[S,g,s]);return D.useEffect((()=>{t&&!j&&C()}),[t,j,C]),D.useEffect((()=>()=>{S(),(null==g?void 0:g.url)&&URL.revokeObjectURL(g.url)}),[S,g]),!1===h?u.jsx(os,{children:t&&u.jsx(cs.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:u.jsxs(cs.div,{initial:{y:20},animate:{y:0},className:"bg-card border border-border rounded-lg p-6 max-w-md mx-4 text-center",children:[u.jsx(be,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),u.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Accès à la caméra refusé"}),u.jsx("p",{className:"text-muted-foreground mb-4",children:p||"Pour utiliser la caméra, vous devez autoriser l'accès dans les paramètres de votre navigateur."}),u.jsxs("div",{className:"flex space-x-2",children:[u.jsx(J,{variant:"outline",onClick:R,children:"Fermer"}),u.jsx(J,{onClick:C,children:"Réessayer"})]})]})})}):u.jsx(os,{children:t&&u.jsx(cs.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:u.jsxs(cs.div,{initial:{y:20},animate:{y:0},className:"bg-card border border-border rounded-lg overflow-hidden max-w-2xl w-full mx-4",children:[u.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[u.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[u.jsx(Ne,{className:"h-5 w-5 mr-2"}),"Prendre une photo"]}),u.jsx(J,{variant:"ghost",size:"icon",onClick:R,className:"hover:bg-destructive hover:text-destructive-foreground",children:u.jsx(te,{className:"h-5 w-5"})})]}),u.jsx("div",{className:"p-4",children:c?u.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[u.jsx(ye,{className:"h-12 w-12 animate-spin text-primary mb-4"}),u.jsx("p",{className:"text-muted-foreground",children:"Initialisation de la caméra..."})]}):g?u.jsxs("div",{className:"space-y-4",children:[u.jsx("div",{className:"relative aspect-video bg-muted rounded-lg overflow-hidden",children:u.jsx("img",{src:g.url,alt:"Photo capturée",className:"w-full h-full object-cover"})}),u.jsxs("div",{className:"flex justify-center space-x-2",children:[u.jsxs(J,{variant:"outline",onClick:A,children:[u.jsx(we,{className:"h-4 w-4 mr-2"}),"Reprendre"]}),u.jsxs(J,{onClick:E,children:[u.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Utiliser cette photo"]})]})]}):u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"relative aspect-video bg-muted rounded-lg overflow-hidden",children:[u.jsx("video",{ref:n,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),!j&&u.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-muted",children:u.jsxs("div",{className:"text-center",children:[u.jsx(Ne,{className:"h-16 w-16 text-muted-foreground mx-auto mb-2"}),u.jsx("p",{className:"text-muted-foreground",children:"Initialisation de la caméra..."})]})})]}),u.jsxs("div",{className:"flex justify-center space-x-2",children:[u.jsxs(J,{variant:"outline",onClick:k,disabled:!j,className:"flex items-center",children:[u.jsx(we,{className:"h-4 w-4 mr-2"}),"Changer de caméra"]}),u.jsxs(J,{onClick:z,disabled:!j,size:"lg",className:"bg-primary hover:bg-primary/90",children:[u.jsx(Ne,{className:"h-5 w-5 mr-2"}),"Prendre la photo"]})]}),u.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:[u.jsx("p",{children:'Positionnez-vous dans le cadre et appuyez sur "Prendre la photo"'}),u.jsx("p",{className:"mt-1",children:"Vous pourrez reprendre la photo si nécessaire"})]})]})})]})})})},Ks=({onFilesSelected:e,onClose:s,isOpen:t=!1,maxFiles:a=10,maxFileSize:r=10485760,acceptedTypes:i=["image/*","video/*","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv","application/zip"],multiple:n=!0})=>{const l=D.useRef(null),d=D.useRef(null),[m,h]=D.useState([]),[x,p]=D.useState(!1),[f,g]=D.useState({}),[v,j]=D.useState([]),[b,N]=D.useState({}),{toast:y}=je(),w=e=>e.type.startsWith("image/")?"image":e.type.startsWith("video/")?"video":e.type.startsWith("application/pdf")?"pdf":e.type.includes("word")||e.type.includes("document")?"document":e.type.includes("excel")||e.type.includes("spreadsheet")?"spreadsheet":e.type.includes("text/")||e.type.includes("csv")?"text":e.type.includes("zip")||e.type.includes("archive")?"archive":"other",C=e=>{switch(e){case"image":return u.jsx(Ee,{className:"h-8 w-8 text-blue-500"});case"video":return u.jsx(oe,{className:"h-8 w-8 text-purple-500"});case"pdf":return u.jsx(Ae,{className:"h-8 w-8 text-red-500"});case"document":return u.jsx(Ae,{className:"h-8 w-8 text-blue-600"});case"spreadsheet":return u.jsx(Ae,{className:"h-8 w-8 text-green-600"});case"text":return u.jsx(Ae,{className:"h-8 w-8 text-gray-600"});case"archive":return u.jsx(ze,{className:"h-8 w-8 text-orange-500"});default:return u.jsx(ze,{className:"h-8 w-8 text-gray-500"})}},S=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]},k=D.useCallback((e=>{if(e.type.startsWith("image/")){const s=new FileReader;s.onload=s=>{N((t=>c(o({},t),{[e.name]:s.target.result})))},s.readAsDataURL(e)}}),[]),z=D.useCallback((e=>{const s=Array.from(e),t=[],n=[];s.forEach((e=>{const s=(e=>{const s=[];return e.size>r&&s.push(`Le fichier "${e.name}" est trop volumineux (${S(e.size)}). Taille maximale : ${S(r)}`),i.some((s=>s.endsWith("/*")?e.type.startsWith(s.slice(0,-1)):e.type===s))||s.push(`Le type de fichier "${e.type}" n'est pas accepté pour "${e.name}"`),m.length<a||s.push(`Nombre maximum de fichiers atteint (${a})`),s})(e);0===s.length?(n.push(e),k(e)):t.push(...s)})),t.length>0&&(j(t),y({title:"Erreurs de validation",description:t.slice(0,3).join(". "),variant:"destructive",duration:5e3})),n.length>0&&(h((e=>[...e,...n])),y({title:"Fichiers ajoutés",description:n.length+" fichier(s) ajouté(s) avec succès.",duration:3e3}))}),[m,a,r,i,k,y]),A=D.useCallback((e=>{e.preventDefault(),p(!1);const s=e.dataTransfer.files;s.length>0&&z(s)}),[z]),E=D.useCallback((e=>{e.preventDefault(),p(!0)}),[]),R=D.useCallback((e=>{e.preventDefault(),p(!1)}),[]),L=D.useCallback((e=>{h((s=>s.filter((s=>s.name!==e)))),N((s=>{const t=o({},s);return delete t[e],t})),g((s=>{const t=o({},s);return delete t[e],t}))}),[]),I=D.useCallback((()=>{m.length>0&&e&&(e(m),s())}),[m,e,s]),_=D.useCallback((e=>{g((s=>c(o({},s),{[e.name]:0})));const s=setInterval((()=>{g((t=>{const a=t[e.name]||0;return 100>a?c(o({},t),{[e.name]:a+10}):(clearInterval(s),t)}))}),100)}),[]),T=D.useCallback((()=>{h([]),N({}),g({}),j([]),s()}),[s]);return u.jsx(os,{children:t&&u.jsx(cs.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:u.jsxs(cs.div,{initial:{y:20},animate:{y:0},className:"bg-card border border-border rounded-lg overflow-hidden max-w-4xl w-full mx-4 max-h-[90vh]",children:[u.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[u.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[u.jsx(Se,{className:"h-5 w-5 mr-2"}),"Sélectionner des fichiers"]}),u.jsx(J,{variant:"ghost",size:"icon",onClick:T,className:"hover:bg-destructive hover:text-destructive-foreground",children:u.jsx(te,{className:"h-5 w-5"})})]}),u.jsxs("div",{className:"p-4 space-y-4",children:[u.jsxs("div",{ref:d,onDrop:A,onDragOver:E,onDragLeave:R,className:`\n                  border-2 border-dashed rounded-lg p-8 text-center transition-colors\n                  ${x?"border-primary bg-primary/10":"border-border hover:border-primary/50"}\n                `,children:[u.jsx(Se,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),u.jsx("h4",{className:"text-lg font-medium mb-2",children:"Glissez-déposez vos fichiers ici"}),u.jsx("p",{className:"text-muted-foreground mb-4",children:"ou cliquez pour sélectionner des fichiers"}),u.jsxs(J,{onClick:()=>{var e;return null==(e=l.current)?void 0:e.click()},variant:"outline",className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[u.jsx(Se,{className:"h-4 w-4 mr-2"}),"Choisir des fichiers"]}),u.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Types acceptés : Images, Vidéos, PDF, Documents, etc.",u.jsx("br",{}),"Taille maximale : ",S(r)," par fichier"]})]}),u.jsx("input",{ref:l,type:"file",multiple:n,accept:i.join(","),onChange:e=>z(e.target.files),className:"hidden"}),m.length>0&&u.jsxs("div",{className:"space-y-3",children:[u.jsxs("h4",{className:"font-medium",children:["Fichiers sélectionnés (",m.length,")"]}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-64 overflow-y-auto",children:m.map(((e,s)=>u.jsx(cs.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"border border-border rounded-lg p-3 bg-muted/30",children:u.jsxs("div",{className:"flex items-start space-x-3",children:[C(w(e)),u.jsxs("div",{className:"flex-1 min-w-0",children:[u.jsx("p",{className:"font-medium text-sm truncate",title:e.name,children:e.name}),u.jsxs("p",{className:"text-xs text-muted-foreground",children:[S(e.size)," • ",w(e)]}),b[e.name]&&u.jsx("div",{className:"mt-2",children:u.jsx("img",{src:b[e.name],alt:e.name,className:"w-16 h-16 object-cover rounded border"})}),void 0!==f[e.name]&&u.jsxs("div",{className:"mt-2",children:[u.jsx(ke,{value:f[e.name],className:"h-2"}),u.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[f[e.name],"% terminé"]})]})]}),u.jsxs("div",{className:"flex space-x-1",children:[u.jsx(J,{variant:"ghost",size:"sm",onClick:()=>_(e),disabled:void 0!==f[e.name],children:u.jsx(Se,{className:"h-4 w-4"})}),u.jsx(J,{variant:"ghost",size:"sm",onClick:()=>L(e.name),className:"text-red-500 hover:text-red-700",children:u.jsx(O,{className:"h-4 w-4"})})]})]})},`${e.name}-${s}`)))})]}),v.length>0&&u.jsx(cs.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"bg-destructive/10 border border-destructive/20 rounded-lg p-3",children:u.jsxs("div",{className:"flex items-start space-x-2",children:[u.jsx(be,{className:"h-5 w-5 text-destructive mt-0.5"}),u.jsxs("div",{className:"flex-1",children:[u.jsx("h4",{className:"font-medium text-destructive mb-2",children:"Erreurs de validation"}),u.jsxs("ul",{className:"text-sm text-destructive space-y-1",children:[v.slice(0,5).map(((e,s)=>u.jsxs("li",{children:["• ",e]},s))),v.length>5&&u.jsxs("li",{children:["• ... et ",v.length-5," autres erreurs"]})]})]})]})})]}),u.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-border bg-muted/30",children:[u.jsx("div",{className:"text-sm text-muted-foreground",children:m.length>0?u.jsxs("span",{className:"flex items-center",children:[u.jsx(Ce,{className:"h-4 w-4 mr-2 text-green-500"}),m.length," fichier(s) prêt(s) à être envoyé(s)"]}):"Aucun fichier sélectionné"}),u.jsxs("div",{className:"flex space-x-2",children:[u.jsx(J,{variant:"outline",onClick:T,children:"Annuler"}),u.jsxs(J,{onClick:I,disabled:0===m.length,className:"bg-primary hover:bg-primary/90",children:[u.jsx(Se,{className:"h-4 w-4 mr-2"}),"Envoyer ",m.length>0&&`(${m.length})`]})]})]})]})})})};delete ds.Icon.Default.prototype._getIconUrl,ds.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const Qs=({center:e=[48.8566,2.3522],zoom:s=13,onLocationSelect:t,selectedLocation:a=null,height:r="400px",className:i=""})=>{const n=D.useRef(null),l=D.useRef(null),o=D.useRef(null),[c,d]=D.useState(!1);D.useEffect((()=>{if(!n.current||l.current)return;const a=ds.map(n.current).setView(e,s);return l.current=a,ds.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:19}).addTo(a),a.on("click",(e=>{const{lat:s,lng:r}=e.latlng;o.current&&a.removeLayer(o.current),o.current=ds.marker([s,r],{icon:ds.divIcon({className:"custom-marker",html:'<div class="w-6 h-6 bg-primary rounded-full border-2 border-white shadow-lg"></div>',iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a),t&&t({latitude:s,longitude:r,timestamp:(new Date).toISOString(),source:"map"})})),a.whenReady((()=>{d(!0)})),()=>{l.current&&(l.current.remove(),l.current=null)}}),[e,s,t]),D.useEffect((()=>{l.current&&a&&(o.current&&l.current.removeLayer(o.current),o.current=ds.marker([a.latitude,a.longitude],{icon:ds.divIcon({className:"custom-marker",html:'<div class="w-6 h-6 bg-primary rounded-full border-2 border-white shadow-lg"></div>',iconSize:[24,24],iconAnchor:[12,12]})}).addTo(l.current),l.current.setView([a.latitude,a.longitude],15))}),[a]);const m=(e,s,t=15)=>{l.current&&l.current.setView([e,s],t)};return D.useEffect((()=>{window.centerMapOnLocation,window.centerMapOnLocation=m}),[]),u.jsxs("div",{className:"relative "+i,children:[u.jsx("div",{ref:n,style:{height:r},className:"w-full rounded-lg overflow-hidden border"}),!c&&u.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-muted/50",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Chargement de la carte..."})]})}),u.jsx("div",{className:"absolute top-2 left-2 bg-white/90 backdrop-blur-sm rounded-lg px-3 py-2 text-xs text-muted-foreground shadow-sm",children:"Cliquez sur la carte pour sélectionner un point"})]})},Zs=new class{constructor(){this.baseUrl="https://nominatim.openstreetmap.org",this.cache=new Map,this.cacheTimeout=3e5}searchLocation(e){return m(this,arguments,(function*(e,s={}){const{limit:t=5,countrycodes:a="",bounded:r=0,viewbox:i="",addressdetails:n=1}=s,l=`${e}_${t}_${a}`,o=this.getFromCache(l);if(o)return o;try{const s=new URLSearchParams({q:e,format:"json",limit:t.toString(),addressdetails:n.toString(),bounded:r.toString()});a&&s.append("countrycodes",a),i&&s.append("viewbox",i);const o=yield fetch(`${this.baseUrl}/search?${s}`,{headers:{Accept:"application/json","User-Agent":"MaxiMarket-LocationPicker/1.0"}});if(!o.ok)throw Error("Erreur HTTP: "+o.status);const c=(yield o.json()).map((e=>({id:e.place_id,name:e.display_name,latitude:parseFloat(e.lat),longitude:parseFloat(e.lon),type:e.type,importance:e.importance,address:e.address,boundingbox:e.boundingbox})));return this.setCache(l,c),c}catch(c){throw Error("Erreur lors de la recherche d'adresse. Veuillez réessayer.")}}))}reverseGeocode(e,s){return m(this,arguments,(function*(e,s,t={}){const{zoom:a=18,addressdetails:r=1,extratags:i=1}=t,n=`reverse_${e}_${s}_${a}`,l=this.getFromCache(n);if(l)return l;try{const t=new URLSearchParams({lat:e.toString(),lon:s.toString(),format:"json",zoom:a.toString(),addressdetails:r.toString(),extratags:i.toString()}),l=yield fetch(`${this.baseUrl}/reverse?${t}`,{headers:{Accept:"application/json","User-Agent":"MaxiMarket-LocationPicker/1.0"}});if(!l.ok)throw Error("Erreur HTTP: "+l.status);const o=yield l.json(),c={id:o.place_id,name:o.display_name,latitude:parseFloat(o.lat),longitude:parseFloat(o.lon),type:o.type,address:o.address,boundingbox:o.boundingbox};return this.setCache(n,c),c}catch(o){throw Error("Erreur lors de la récupération de l'adresse. Veuillez réessayer.")}}))}searchPopularPlaces(e){return m(this,arguments,(function*(e,s={}){const{limit:t=10,countrycodes:a="fr,be,ch,ca"}=s;try{return(yield this.searchLocation(e,{limit:t,countrycodes:a})).sort(((e,s)=>s.importance-e.importance))}catch(r){return[]}}))}validateCoordinates(e,s){const t=parseFloat(e),a=parseFloat(s);return!(isNaN(t)||isNaN(a)||-90>t||t>90||-180>a||a>180)}formatAddress(e){if(!e)return"";const s=[];return e.house_number&&s.push(e.house_number),e.road&&s.push(e.road),e.postcode&&s.push(e.postcode),(e.city||e.town||e.village)&&s.push(e.city||e.town||e.village),e.country&&s.push(e.country),s.join(", ")}getFromCache(e){const s=this.cache.get(e);return s?Date.now()-s.timestamp>this.cacheTimeout?(this.cache.delete(e),null):s.data:null}setCache(e,s){this.cache.set(e,{data:s,timestamp:Date.now()})}clearCache(){this.cache.clear()}getCacheStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}},Js=({onLocationSelect:e,onClose:s,isOpen:t=!1,defaultLocation:a=null,showMap:r=!0})=>{D.useRef(null);const i=D.useRef(null),[n,l]=D.useState(!1),[o,c]=D.useState(null),[d,h]=D.useState(null),[x,p]=D.useState(a),[f,g]=D.useState(""),[v,j]=D.useState([]),[b,N]=D.useState(!1),[y,w]=D.useState(null),{toast:C}=je(),S=D.useCallback((()=>m(null,null,(function*(){if(!navigator.geolocation)return void h("La géolocalisation n'est pas supportée par votre navigateur");l(!0),h(null);const e={enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4};try{const s=yield new Promise(((s,t)=>{navigator.geolocation.getCurrentPosition(s,t,e)})),{latitude:t,longitude:a}=s.coords,r={latitude:t,longitude:a,accuracy:s.coords.accuracy,timestamp:(new Date).toISOString(),source:"gps"};w(r),p(r),c(!0),C({title:"Position obtenue !",description:`Précision : ${Math.round(s.coords.accuracy)} mètres`,duration:3e3})}catch(s){1===s.code?h("Permission de géolocalisation refusée. Veuillez autoriser l'accès à votre position dans les paramètres de votre navigateur."):2===s.code?h("Impossible de déterminer votre position. Vérifiez que votre GPS est activé."):3===s.code?h("Délai d'attente dépassé. Vérifiez votre connexion internet."):h("Erreur lors de la géolocalisation. Veuillez réessayer."),c(!1)}finally{l(!1)}}))),[C]),k=D.useCallback((e=>m(null,null,(function*(){if(e.trim()){N(!0),h(null);try{const s=yield Zs.searchLocation(e,{limit:8,countrycodes:"fr,be,ch,ca",addressdetails:1});j(s)}catch(s){h(s.message||"Erreur lors de la recherche. Veuillez réessayer."),j([])}finally{N(!1)}}else j([])}))),[]),z=D.useCallback((e=>{const s={latitude:e.latitude,longitude:e.longitude,name:e.name,timestamp:(new Date).toISOString(),source:"search"};p(s),g(e.name),j([]),C({title:"Localisation sélectionnée !",description:e.name,duration:3e3})}),[C]),A=D.useCallback(((e,s)=>m(null,null,(function*(){try{const t=yield Zs.reverseGeocode(e,s),a={latitude:e,longitude:s,name:t.name,address:Zs.formatAddress(t.address),timestamp:(new Date).toISOString(),source:"map"};p(a),C({title:"Position sélectionnée !",description:t.name||`Lat: ${e.toFixed(6)}, Lng: ${s.toFixed(6)}`,duration:3e3})}catch(t){const a={latitude:e,longitude:s,timestamp:(new Date).toISOString(),source:"map"};p(a),C({title:"Position sélectionnée !",description:`Lat: ${e.toFixed(6)}, Lng: ${s.toFixed(6)}`,duration:3e3})}}))),[C]),E=D.useCallback((()=>{x&&e&&(e(x),s())}),[x,e,s]),R=D.useCallback((()=>{p(null),g(""),j([]),h(null),s()}),[s]);return D.useEffect((()=>{const e=setTimeout((()=>{f.trim()&&k(f)}),500);return()=>clearTimeout(e)}),[f,k]),D.useEffect((()=>{!t||a||y||S()}),[t,a,y,S]),!1===o?u.jsx(os,{children:t&&u.jsx(cs.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:u.jsxs(cs.div,{initial:{y:20},animate:{y:0},className:"bg-card border border-border rounded-lg p-6 max-w-md mx-4 text-center",children:[u.jsx(be,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),u.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Accès à la localisation refusé"}),u.jsx("p",{className:"text-muted-foreground mb-4",children:d||"Pour utiliser la géolocalisation, vous devez autoriser l'accès à votre position dans les paramètres de votre navigateur."}),u.jsxs("div",{className:"flex space-x-2",children:[u.jsx(J,{variant:"outline",onClick:R,children:"Fermer"}),u.jsx(J,{onClick:S,children:"Réessayer"})]})]})})}):u.jsx(os,{children:t&&u.jsx(cs.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:u.jsxs(cs.div,{initial:{y:20},animate:{y:0},className:"bg-card border border-border rounded-lg overflow-hidden max-w-4xl w-full mx-4 max-h-[90vh]",children:[u.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[u.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[u.jsx(Re,{className:"h-5 w-5 mr-2"}),"Sélectionner une localisation"]}),u.jsx(J,{variant:"ghost",size:"icon",onClick:R,className:"hover:bg-destructive hover:text-destructive-foreground",children:u.jsx(te,{className:"h-5 w-5"})})]}),u.jsxs("div",{className:"p-4 space-y-4",children:[u.jsxs("div",{className:"relative",children:[u.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),u.jsx(xe,{ref:i,placeholder:"Rechercher une adresse, ville, lieu...",value:f,onChange:e=>g(e.target.value),className:"pl-10 pr-4"}),b&&u.jsx(ye,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 animate-spin text-muted-foreground"})]}),v.length>0&&u.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:v.map((e=>u.jsxs(cs.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center space-x-3 p-3 border rounded-lg hover:bg-muted/50 cursor-pointer transition-colors",onClick:()=>z(e),children:[u.jsx(Re,{className:"h-4 w-4 text-primary"}),u.jsxs("div",{className:"flex-1",children:[u.jsx("p",{className:"font-medium text-sm",children:e.name}),u.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.type," • ",Zs.formatAddress(e.address)]})]})]},e.id)))}),r&&u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx("h4",{className:"font-medium",children:"Carte interactive"}),u.jsxs("div",{className:"flex space-x-2",children:[u.jsxs(J,{variant:"outline",size:"sm",onClick:S,disabled:n,className:"flex items-center",children:[u.jsx(Le,{className:"h-4 w-4 mr-2"}),"Ma position"]}),u.jsxs(J,{variant:"outline",size:"sm",onClick:()=>{x&&window.centerMapOnLocation&&window.centerMapOnLocation(x.latitude,x.longitude)},disabled:!x,className:"flex items-center",children:[u.jsx(U,{className:"h-4 w-4 mr-2"}),"Centrer"]})]})]}),u.jsx(Qs,{center:y?[y.latitude,y.longitude]:[48.8566,2.3522],zoom:13,onLocationSelect:A,selectedLocation:x,height:"400px",className:"w-full"})]}),x&&u.jsx(cs.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"bg-primary/10 border border-primary/20 rounded-lg p-4",children:u.jsxs("div",{className:"flex items-start space-x-3",children:[u.jsx(Ce,{className:"h-5 w-5 text-primary mt-0.5"}),u.jsxs("div",{className:"flex-1",children:[u.jsx("h4",{className:"font-medium text-primary mb-2",children:"Localisation sélectionnée"}),u.jsxs("div",{className:"space-y-1 text-sm",children:[u.jsxs("p",{children:[u.jsx("strong",{children:"Latitude :"})," ",x.latitude.toFixed(6)]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Longitude :"})," ",x.longitude.toFixed(6)]}),x.name&&u.jsxs("p",{children:[u.jsx("strong",{children:"Nom :"})," ",x.name]}),x.address&&u.jsxs("p",{children:[u.jsx("strong",{children:"Adresse :"})," ",x.address]}),x.accuracy&&u.jsxs("p",{children:[u.jsx("strong",{children:"Précision :"})," ",Math.round(x.accuracy)," mètres"]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Source :"})," ",x.source]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Heure :"})," ",new Date(x.timestamp).toLocaleTimeString()]})]})]})]})}),d&&u.jsx(cs.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"bg-destructive/10 border border-destructive/20 rounded-lg p-3",children:u.jsxs("div",{className:"flex items-start space-x-2",children:[u.jsx(be,{className:"h-5 w-5 text-destructive mt-0.5"}),u.jsxs("div",{className:"flex-1",children:[u.jsx("h4",{className:"font-medium text-destructive mb-2",children:"Erreur"}),u.jsx("p",{className:"text-sm text-destructive",children:d})]})]})})]}),u.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-border bg-muted/30",children:[u.jsx("div",{className:"text-sm text-muted-foreground",children:x?u.jsxs("span",{className:"flex items-center",children:[u.jsx(Ce,{className:"h-4 w-4 mr-2 text-green-500"}),"Localisation prête à être envoyée"]}):"Aucune localisation sélectionnée"}),u.jsxs("div",{className:"flex space-x-2",children:[u.jsx(J,{variant:"outline",onClick:R,children:"Annuler"}),u.jsxs(J,{onClick:E,disabled:!x,className:"bg-primary hover:bg-primary/90",children:[u.jsx(Re,{className:"h-4 w-4 mr-2"}),"Utiliser cette localisation"]})]})]})]})})})},Ys=({onAppointmentCreate:e,onClose:s,isOpen:t=!1,existingAppointments:a=[],availableSlots:r=[],timezone:i="Europe/Paris"})=>{const[n,l]=D.useState(""),[o,c]=D.useState(""),[d,h]=D.useState(60),[x,p]=D.useState(""),[f,g]=D.useState(""),[v,j]=D.useState(""),[b,N]=D.useState(1),[y,w]=D.useState(!1),[C,S]=D.useState(null),{toast:k}=je(),z=D.useCallback((()=>{const e=[],s=new Date;for(let t=0;30>t;t++){const a=new Date(s);a.setDate(s.getDate()+t);const r=a.getDay();0!==r&&6!==r&&e.push({date:a.toISOString().split("T")[0],label:a.toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short"}),isToday:0===t})}return e}),[]),A=D.useCallback((()=>m(null,null,(function*(){if(n&&o&&x.trim()){w(!0),S(null);try{const t={id:Date.now().toString(),date:n,time:o,duration:d,title:x.trim(),description:f.trim(),location:v.trim(),timezone:i,createdAt:(new Date).toISOString(),status:"confirmed"};yield new Promise((e=>setTimeout(e,1e3))),e&&e(t),k({title:"Rendez-vous créé !",description:`Le rendez-vous "${x}" a été planifié avec succès.`,duration:5e3}),s()}catch(t){S("Erreur lors de la création du rendez-vous. Veuillez réessayer.")}finally{w(!1)}}else S("Veuillez remplir tous les champs obligatoires")}))),[n,o,d,x,f,v,i,e,s,k]),E=D.useCallback((()=>{l(""),c(""),h(60),p(""),g(""),j(""),S(null),N(1),s()}),[s]),R=z();return u.jsx(os,{children:t&&u.jsx(cs.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:u.jsxs(cs.div,{initial:{y:20},animate:{y:0},className:"bg-card border border-border rounded-lg overflow-hidden max-w-4xl w-full mx-4 max-h-[90vh]",children:[u.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[u.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[u.jsx(Ie,{className:"h-5 w-5 mr-2"}),"Planifier un rendez-vous"]}),u.jsx(J,{variant:"ghost",size:"icon",onClick:E,className:"hover:bg-destructive hover:text-destructive-foreground",children:u.jsx(te,{className:"h-5 w-5"})})]}),u.jsxs("div",{className:"p-4 space-y-4",children:[u.jsx("h4",{className:"font-medium",children:"Sélectionnez une date et une heure"}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium mb-2",children:"Date"}),u.jsx("div",{className:"grid grid-cols-5 gap-2",children:R.map((e=>u.jsx(J,{variant:n===e.date?"default":"outline",size:"sm",onClick:()=>l(e.date),className:"h-12 "+(e.isToday?"ring-2 ring-primary":""),children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"text-xs text-muted-foreground",children:e.label.split(" ")[0]}),u.jsx("div",{className:"font-medium",children:e.label.split(" ")[1]})]})},e.date)))})]}),n&&u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium mb-2",children:"Heure"}),u.jsx("div",{className:"grid grid-cols-4 gap-2",children:["09:00","10:00","11:00","14:00","15:00","16:00","17:00"].map((e=>u.jsx(J,{variant:o===e?"default":"outline",size:"sm",onClick:()=>c(e),className:"h-10",children:e},e)))})]}),n&&o&&u.jsxs("div",{className:"space-y-4",children:[u.jsx("h4",{className:"font-medium",children:"Détails du rendez-vous"}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium mb-2",children:"Titre *"}),u.jsx(xe,{placeholder:"Titre du rendez-vous",value:x,onChange:e=>p(e.target.value)})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium mb-2",children:"Description"}),u.jsx(De,{placeholder:"Description du rendez-vous...",value:f,onChange:e=>g(e.target.value),rows:3})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium mb-2",children:"Lieu"}),u.jsx(xe,{placeholder:"Adresse ou lieu",value:v,onChange:e=>j(e.target.value)})]})]}),C&&u.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-3",children:u.jsxs("div",{className:"flex items-start space-x-2",children:[u.jsx(be,{className:"h-5 w-5 text-destructive mt-0.5"}),u.jsxs("div",{className:"flex-1",children:[u.jsx("h4",{className:"font-medium text-destructive mb-2",children:"Erreur"}),u.jsx("p",{className:"text-sm text-destructive",children:C})]})]})})]}),u.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-border bg-muted/30",children:[u.jsx("div",{className:"text-sm text-muted-foreground",children:"Rendez-vous"}),u.jsxs("div",{className:"flex space-x-2",children:[u.jsx(J,{variant:"outline",onClick:E,children:"Annuler"}),u.jsx(J,{onClick:A,disabled:y||!n||!o||!x.trim(),className:"bg-primary hover:bg-primary/90",children:y?u.jsxs(u.Fragment,{children:[u.jsx(ye,{className:"h-4 w-4 mr-2 animate-spin"}),"Création..."]}):u.jsxs(u.Fragment,{children:[u.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Créer le rendez-vous"]})})]})]})]})})})},Xs=ms(ss());var et={};const st=new class{constructor(){this.socket=null,this.peer=null,this.localStream=null,this.remoteStream=null,this.callState="idle",this.callDuration=0,this.callTimer=null,this.callStartTime=null,this.onCallStateChange=null,this.onRemoteStream=null,this.onCallDuration=null,this.onError=null,this.config={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"}],audio:!0,video:!1}}initialize(e,s){return m(this,null,(function*(){try{return this.socket=ts(et.REACT_APP_SIGNALING_SERVER||"http://localhost:3001",{query:{userId:e,roomId:s}}),this.setupSocketListeners(),yield this.requestAudioPermission(),!0}catch(t){return this.handleError(t),!1}}))}requestAudioPermission(){return m(this,null,(function*(){try{return this.localStream=yield navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:44100},video:!1}),!0}catch(e){throw Error("Accès au microphone refusé. Veuillez autoriser l'accès audio.")}}))}setupSocketListeners(){this.socket&&(this.socket.on("incoming-call",(e=>{this.callState="incoming",this.triggerCallStateChange()})),this.socket.on("call-answered",(e=>{this.handleCallAnswered(e)})),this.socket.on("call-rejected",(e=>{this.callState="ended",this.triggerCallStateChange(),this.cleanup()})),this.socket.on("call-ended",(e=>{this.endCall()})),this.socket.on("webrtc-signal",(e=>{this.peer&&this.peer.signal(e.signal)})),this.socket.on("connect",(()=>{})),this.socket.on("disconnect",(()=>{this.handleError(Error("Connexion perdue au serveur"))})))}startCall(e,s){return m(this,null,(function*(){try{if("idle"!==this.callState)throw Error("Un appel est déjà en cours");return this.localStream||(yield this.requestAudioPermission()),this.callState="calling",this.triggerCallStateChange(),this.peer=new Xs({initiator:!0,trickle:!1,stream:this.localStream,config:{iceServers:this.config.iceServers}}),this.setupPeerListeners(),this.socket.emit("start-call",{targetUserId:e,roomId:s,callerId:this.socket.id}),!0}catch(t){return this.handleError(t),!1}}))}answerCall(e,s){return m(this,null,(function*(){try{if("incoming"!==this.callState)throw Error("Aucun appel entrant");return this.localStream||(yield this.requestAudioPermission()),this.callState="connected",this.triggerCallStateChange(),this.peer=new Xs({initiator:!1,trickle:!1,stream:this.localStream,config:{iceServers:this.config.iceServers}}),this.setupPeerListeners(),this.socket.emit("answer-call",{callerId:e,roomId:s,answererId:this.socket.id}),this.startCallTimer(),!0}catch(t){return this.handleError(t),!1}}))}rejectCall(e,s){try{this.socket.emit("reject-call",{callerId:e,roomId:s,rejecterId:this.socket.id}),this.callState="ended",this.triggerCallStateChange(),this.cleanup()}catch(t){this.handleError(t)}}endCall(){try{"connected"===this.callState&&this.socket.emit("end-call",{enderId:this.socket.id}),this.callState="ended",this.triggerCallStateChange(),this.cleanup()}catch(e){this.handleError(e)}}setupPeerListeners(){this.peer&&(this.peer.on("signal",(e=>{this.socket.emit("webrtc-signal",{signal:e})})),this.peer.on("connect",(()=>{this.callState="connected",this.triggerCallStateChange(),this.startCallTimer()})),this.peer.on("stream",(e=>{this.remoteStream=e,this.onRemoteStream&&this.onRemoteStream(e)})),this.peer.on("error",(e=>{this.handleError(e)})),this.peer.on("close",(()=>{this.endCall()})))}startCallTimer(){this.callStartTime=Date.now(),this.callDuration=0,this.callTimer=setInterval((()=>{this.callDuration=Math.floor((Date.now()-this.callStartTime)/1e3),this.onCallDuration&&this.onCallDuration(this.callDuration)}),1e3)}handleCallAnswered(e){this.peer&&"calling"===this.callState&&(this.callState="connected",this.triggerCallStateChange(),this.startCallTimer())}cleanup(){this.callTimer&&(clearInterval(this.callTimer),this.callTimer=null),this.peer&&(this.peer.destroy(),this.peer=null),this.localStream&&(this.localStream.getTracks().forEach((e=>e.stop())),this.localStream=null),this.callState="idle",this.callDuration=0,this.callStartTime=null,this.remoteStream=null}handleError(e){this.onError&&this.onError(e)}triggerCallStateChange(){this.onCallStateChange&&this.onCallStateChange(this.callState)}formatCallDuration(e){const s=Math.floor(e/3600),t=Math.floor(e%3600/60),a=e%60;return s>0?`${s.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`:`${t.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`}getCallState(){return{state:this.callState,duration:this.callDuration,formattedDuration:this.formatCallDuration(this.callDuration),hasLocalStream:!!this.localStream,hasRemoteStream:!!this.remoteStream}}isInCall(){return["calling","incoming","connected"].includes(this.callState)}isConnected(){return"connected"===this.callState}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null),this.cleanup()}setCallbacks(e){this.onCallStateChange=e.onCallStateChange,this.onRemoteStream=e.onRemoteStream,this.onCallDuration=e.onCallDuration,this.onError=e.onError}},tt=({isOpen:e=!1,onClose:s,targetUser:t=null,currentUser:a=null,roomId:r=null})=>{const[i,n]=D.useState("idle"),[l,o]=D.useState(0),[c,d]=D.useState(!1),[h,x]=D.useState(!0),[p,f]=D.useState(!1),[g,v]=D.useState(null),[j,b]=D.useState(!1),N=D.useRef(null),{toast:y}=je();D.useEffect((()=>{e&&a&&r&&w()}),[e,a,r]),D.useEffect((()=>{e||k()}),[e]);const w=()=>m(null,null,(function*(){try{f(!0),v(null),setTimeout((()=>{n("calling"),f(!1),y({title:"Appel initialisé",description:"Appel en cours vers "+((null==t?void 0:t.first_name)||(null==t?void 0:t.last_name)||"l'utilisateur"),duration:3e3})}),1e3)}catch(e){v(e.message),y({title:"Erreur d'initialisation",description:e.message,variant:"destructive",duration:5e3})}finally{f(!1)}}));D.useCallback((e=>{n(e),b("connected"===e),"ended"===e&&setTimeout((()=>{s()}),2e3)}),[s]),D.useCallback((e=>{N.current&&(N.current.srcObject=e,N.current.play().catch(console.error))}),[]),D.useCallback((e=>{o(e)}),[]);const C=D.useCallback((e=>{v(e.message),y({title:"Erreur d'appel",description:e.message,variant:"destructive",duration:5e3})}),[y]),S=()=>{st.endCall(),y({title:"Appel terminé",description:"L'appel a été terminé",duration:3e3})},k=()=>{st.disconnect(),n("idle"),o(0),b(!1),v(null)},z=e=>{const s=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`};return e?u.jsx(os,{children:u.jsx(cs.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:u.jsxs(cs.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},exit:{y:20,opacity:0},className:"bg-white dark:bg-gray-900 rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden",children:[u.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 p-6 text-white text-center relative",children:[u.jsx("button",{onClick:()=>{st.isInCall()&&S(),s()},className:"absolute top-4 right-4 p-2 rounded-full bg-white/20 hover:bg-white/30 transition-colors",children:u.jsx(te,{className:"h-5 w-5"})}),u.jsx("div",{className:"flex items-center justify-center mb-4",children:(()=>{switch(i){case"calling":return u.jsx(Fe,{className:"h-6 w-6 text-orange-500"});case"incoming":return u.jsx(Oe,{className:"h-6 w-6 text-green-500"});case"connected":return u.jsx(le,{className:"h-6 w-6 text-green-500"});default:return u.jsx(le,{className:"h-6 w-6 text-gray-500"})}})()}),u.jsx("h2",{className:"text-xl font-semibold mb-1",children:(()=>{switch(i){case"calling":return"Appel en cours...";case"incoming":return"Appel entrant";case"connected":return"Appel en cours";case"ended":return"Appel terminé";default:return"Prêt pour l'appel"}})()}),u.jsx("p",{className:"text-blue-100 text-sm",children:"connected"===i?"Durée: "+z(l):t?"Appel de "+(t.name||t.email):"En attente..."})]}),u.jsxs("div",{className:"p-6 space-y-6",children:[t&&u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center",children:u.jsx(ae,{className:"h-10 w-10 text-white"})}),u.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.name||"Utilisateur"}),t.email&&u.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:t.email})]}),u.jsxs("div",{className:"text-center",children:[u.jsx(de,{variant:"connected"===i?"default":"secondary",children:i.toUpperCase()}),"connected"===i&&u.jsxs("div",{className:"flex items-center justify-center mt-2 text-green-600",children:[u.jsx(fe,{className:"h-4 w-4 mr-2"}),u.jsx("span",{className:"font-mono",children:z(l)})]})]}),g&&u.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 flex items-center",children:[u.jsx(be,{className:"h-5 w-5 text-red-500 mr-2"}),u.jsx("span",{className:"text-red-700 text-sm",children:g})]}),u.jsxs("div",{className:"space-y-3",children:["idle"===i&&u.jsx(J,{onClick:()=>m(null,null,(function*(){try{if(!t||!r)throw Error("Informations manquantes pour l'appel");(yield st.startCall(t.id,r))&&y({title:"Appel en cours...",description:"Appel de "+(t.name||t.email),duration:3e3})}catch(e){C(e)}})),disabled:p||!t,className:"w-full bg-green-600 hover:bg-green-700 text-white",size:"lg",children:p?u.jsxs(u.Fragment,{children:[u.jsx(ye,{className:"h-5 w-5 mr-2 animate-spin"}),"Initialisation..."]}):u.jsxs(u.Fragment,{children:[u.jsx(le,{className:"h-5 w-5 mr-2"}),"Appeler"]})}),"incoming"===i&&u.jsxs("div",{className:"flex space-x-3",children:[u.jsxs(J,{onClick:()=>m(null,null,(function*(){try{(yield st.answerCall())&&y({title:"Appel accepté",description:"Connexion en cours...",duration:3e3})}catch(e){C(e)}})),className:"flex-1 bg-green-600 hover:bg-green-700 text-white",size:"lg",children:[u.jsx(le,{className:"h-5 w-5 mr-2"}),"Répondre"]}),u.jsxs(J,{onClick:()=>{st.rejectCall(),y({title:"Appel refusé",description:"L'appel a été refusé",duration:3e3,variant:"destructive"})},variant:"destructive",className:"flex-1",size:"lg",children:[u.jsx(_e,{className:"h-5 w-5 mr-2"}),"Refuser"]})]}),"calling"===i&&u.jsxs(J,{onClick:S,variant:"destructive",className:"w-full",size:"lg",children:[u.jsx(_e,{className:"h-5 w-5 mr-2"}),"Annuler l'appel"]}),"connected"===i&&u.jsxs(J,{onClick:S,variant:"destructive",className:"w-full",size:"lg",children:[u.jsx(_e,{className:"h-5 w-5 mr-2"}),"Terminer l'appel"]}),"connected"===i&&u.jsxs("div",{className:"flex space-x-3 pt-3 border-t",children:[u.jsxs(J,{onClick:()=>{if(st.localStream){const e=st.localStream.getAudioTracks()[0];e&&(e.enabled=!e.enabled,d(!e.enabled),y({title:c?"Micro activé":"Micro désactivé",description:c?"Votre voix est maintenant audible":"Votre voix est maintenant muette",duration:2e3}))}},variant:c?"destructive":"outline",className:"flex-1",children:[c?u.jsx(Te,{className:"h-4 w-4 mr-2"}):u.jsx(Pe,{className:"h-4 w-4 mr-2"}),c?"Activer":"Muet"]}),u.jsxs(J,{onClick:()=>{N.current&&(N.current.muted=!N.current.muted,x(!N.current.muted),y({title:h?"Haut-parleur désactivé":"Haut-parleur activé",description:h?"Son désactivé":"Son activé",duration:2e3}))},variant:h?"outline":"destructive",className:"flex-1",children:[h?u.jsx(Me,{className:"h-4 w-4 mr-2"}):u.jsx($e,{className:"h-4 w-4 mr-2"}),h?"Désactiver":"Activer"]})]})]}),u.jsx("div",{className:"text-center text-sm text-gray-500",children:j?u.jsxs("div",{className:"flex items-center justify-center text-green-600",children:[u.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Connecté"]}):u.jsxs("div",{className:"flex items-center justify-center text-gray-400",children:[u.jsx(ye,{className:"h-4 w-4 mr-2 animate-spin"}),"Connexion..."]})})]}),u.jsx("audio",{ref:N,autoPlay:!0,playsInline:!0,className:"hidden"})]})})}):null},at=({value:e,onChange:s,onSend:t,onAttachment:a,onEmoji:r,onVoice:i,onCamera:n,placeholder:l="Tapez votre message...",disabled:o=!1,showActions:c=!0})=>{const[d,m]=D.useState(!1),[h,x]=D.useState(!1),[p,f]=D.useState(!1),[g,v]=D.useState(!1),[j,b]=D.useState(!1),[N,y]=D.useState(!1),w=D.useRef(null),C=()=>{e.trim()&&!o&&t(e.trim())},S=[{icon:Ee,label:"Photo",action:()=>f(!0)},{icon:Ne,label:"Caméra",action:()=>x(!0)},{icon:ze,label:"Document",action:()=>f(!0)},{icon:Re,label:"Localisation",action:()=>v(!0)},{icon:Ie,label:"Rendez-vous",action:()=>b(!0)},{icon:le,label:"Appel",action:()=>y(!0)},{icon:oe,label:"Vidéo",action:()=>{}}];return u.jsxs("div",{className:"bg-background border-t border-border p-4",children:[d&&u.jsx("div",{className:"mb-3 p-3 bg-muted/50 rounded-lg",children:u.jsx("div",{className:"grid grid-cols-4 gap-2",children:S.map(((e,s)=>u.jsxs(J,{variant:"ghost",size:"sm",onClick:e.action,className:"flex flex-col items-center space-y-1 p-2 h-auto",children:[u.jsx(e.icon,{className:"h-5 w-5 text-muted-foreground"}),u.jsx("span",{className:"text-xs text-muted-foreground",children:e.label})]},s)))})}),u.jsxs("div",{className:"flex items-end space-x-2",children:[u.jsx(J,{variant:"ghost",size:"sm",onClick:()=>m(!d),className:"p-2 flex-shrink-0",children:u.jsx(Ue,{className:"h-4 w-4 transition-transform "+(d?"rotate-45":"")})}),u.jsxs("div",{className:"flex-1 relative",children:[u.jsx(xe,{ref:w,placeholder:l,value:e,onChange:s,onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),C())},disabled:o,className:"pr-20 resize-none",style:{minHeight:"44px"}}),u.jsxs("div",{className:"absolute right-2 bottom-2 flex items-center space-x-1",children:[u.jsx(J,{variant:"ghost",size:"sm",onClick:r,className:"p-1 h-6 w-6",children:u.jsx(Ve,{className:"h-4 w-4"})}),u.jsx(J,{variant:"ghost",size:"sm",onClick:a,className:"p-1 h-6 w-6",children:u.jsx(qe,{className:"h-4 w-4"})})]})]}),u.jsx(J,{onClick:C,disabled:!e.trim()||o,className:"bg-primary hover:bg-primary/90 flex-shrink-0 px-4",children:u.jsx(Be,{className:"h-4 w-4"})})]}),u.jsx("input",{ref:w,type:"file",multiple:!0,accept:"image/*,video/*,.pdf,.doc,.docx,.txt",onChange:e=>{const s=Array.from(e.target.files);s.length>0&&a(s)},className:"hidden"}),e&&u.jsx("div",{className:"mt-2 text-xs text-muted-foreground text-center",children:"Appuyez sur Entrée pour envoyer, Shift+Entrée pour une nouvelle ligne"}),u.jsx(Ws,{isOpen:h,onClose:()=>x(!1),onCapture:e=>{const s=new ze([e.blob],`photo_${Date.now()}.jpg`,{type:"image/jpeg",lastModified:Date.now()});a&&a([s])}}),u.jsx(Ks,{isOpen:p,onClose:()=>f(!1),onFilesSelected:e=>{a&&a(e)}}),u.jsx(Js,{isOpen:g,onClose:()=>v(!1),onLocationSelect:e=>{const s=`📍 Localisation partagée\nLat: ${e.latitude.toFixed(6)}\nLng: ${e.longitude.toFixed(6)}${e.name?"\nLieu: "+e.name:""}`;a&&a([{type:"location",data:e,message:s}])}}),u.jsx(Ys,{isOpen:j,onClose:()=>b(!1),onAppointmentCreate:e=>{const s=`📅 Rendez-vous planifié\nTitre: ${e.title}\nDate: ${new Date(e.date).toLocaleDateString("fr-FR")}\nHeure: ${e.time}${e.location?"\nLieu: "+e.location:""}${e.description?"\nDescription: "+e.description:""}`;a&&a([{type:"appointment",data:e,message:s}])}}),u.jsx(tt,{isOpen:N,onClose:()=>y(!1),targetUser:{id:"user123",name:"Utilisateur Test",email:"test@example.com"},currentUser:{id:"currentUser",name:"Moi"},roomId:"room123"})]})},rt=({size:e="default",className:s=""})=>u.jsx(Bs,{size:e,showStatus:!0,className:s}),it=new ns({defaultOptions:{queries:{staleTime:3e4,gcTime:3e5,retry:1}}}),nt=()=>{var e;const{user:s}=function(){const[e,s]=D.useState(null),[t,a]=D.useState(!0),[r,i]=D.useState(null);return D.useEffect((()=>{m(null,null,(function*(){var e;try{const{data:{session:t}}=yield ie.auth.getSession();i(t),s(null!=(e=null==t?void 0:t.user)?e:null)}catch(l){}finally{a(!1)}}));const{data:{subscription:e}}=ie.auth.onAuthStateChange(((e,t)=>m(null,null,(function*(){var e;i(t),s(null!=(e=null==t?void 0:t.user)?e:null),a(!1)}))));return()=>e.unsubscribe()}),[]),{user:e,session:r,loading:t,signIn:(e,s)=>m(null,null,(function*(){try{const{data:t,error:a}=yield ie.auth.signInWithPassword({email:e,password:s});if(a)throw a;return{data:t,error:null}}catch(l){return{data:null,error:l}}})),signUp:(e,s,...t)=>m(null,[e,s,...t],(function*(e,s,t={}){try{const{data:a,error:r}=yield ie.auth.signUp({email:e,password:s,options:{data:t}});if(r)throw r;return{data:a,error:null}}catch(l){return{data:null,error:l}}})),signOut:()=>m(null,null,(function*(){try{const{error:e}=yield ie.auth.signOut();if(e)throw e;return{error:null}}catch(l){return{error:l}}})),resetPassword:e=>m(null,null,(function*(){try{const{data:s,error:t}=yield ie.auth.resetPasswordForEmail(e,{redirectTo:window.location.origin+"/reset-password"});if(t)throw t;return{data:s,error:null}}catch(l){return{data:null,error:l}}})),updatePassword:e=>m(null,null,(function*(){try{const{data:s,error:t}=yield ie.auth.updateUser({password:e});if(t)throw t;return{data:s,error:null}}catch(l){return{data:null,error:l}}})),isAuthenticated:!!e}}(),{toast:t}=je(),[a]=T(),{data:r,isLoading:i,error:l,refetch:d}=((e={})=>{const{user:s}=re();return as({queryKey:["conversations",null==s?void 0:s.id,e],queryFn:()=>m(null,null,(function*(){var e;try{return yield ne.getUserConversations()}catch(l){throw"PGRST116"===l.code?Error("Erreur de base de données: Vérifiez la structure des tables"):(null==(e=l.message)?void 0:e.includes("Invalid Refresh Token"))?Error("Session expirée. Veuillez vous reconnecter."):400===l.status?Error("Requête invalide. Vérifiez les paramètres."):Error("Erreur de messagerie: "+(l.message||"Erreur inconnue"))}})),enabled:!!s,staleTime:3e4,gcTime:3e5,retry:(e,s)=>{var t,a;return!(null==(t=s.message)?void 0:t.includes("Session expirée"))&&!(null==(a=s.message)?void 0:a.includes("Utilisateur non connecté"))&&2>e},retryDelay:e=>Math.min(1e3*n(2,e),3e4)})})(),h=rs(),[x,p]=D.useState(null),[f,g]=D.useState([]),[v,j]=D.useState(""),[b,N]=D.useState("all"),[y,w]=D.useState(!1),[C,S]=D.useState(!1),[k,z]=D.useState(""),[A,E]=D.useState(!1),[R,L]=D.useState(null),[I,_]=D.useState(new Set),[P,$]=D.useState(!1),[M,F]=D.useState(null),[U,q]=D.useState(!1),[B,G]=D.useState(null),[H,W]=D.useState(!1);D.useEffect((()=>{const e=()=>{W(768>window.innerWidth)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(e=>{const s=rs(),{user:t}=re();D.useEffect((()=>{if(!e||!t)return;const a=ie.channel("messages:"+e).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:"conversation_id=eq."+e},(t=>{s.setQueryData(["conversation-messages",e],(e=>{if(!e)return e;const s=t.new,a=[...e.pages];return a.length>0&&(a[a.length-1]=[...a[a.length-1],s]),c(o({},e),{pages:a})})),s.setQueryData(["conversations"],(s=>s?s.map((s=>s.id===e?c(o({},s),{last_message_at:newMessage.created_at,messages:[...s.messages||[],newMessage]}):s)):s))})).subscribe();return()=>{ie.removeChannel(a)}}),[e,t,s])})(null==x?void 0:x.id);const K=ls({mutationFn:e=>ne.deleteConversation(e),onSuccess:()=>{h.invalidateQueries(["conversations"]),t({title:"Conversation supprimée",description:"La conversation a été supprimée définitivement"})},onError:e=>{t({title:"Erreur",description:"Impossible de supprimer la conversation",variant:"destructive"})}});D.useEffect((()=>{if(!r||0===r.length)return;const e=a.get("conversation"),s=a.get("listing");if(e&&!x){const s=r.find((s=>s.id===e));s&&(p(s),Q(s.id))}else if(s&&!x){const e=r.find((e=>e.listing_id===s));e&&(p(e),Q(e.id))}}),[r,a,x]),D.useEffect((()=>{if(!s)return;const e=ie.channel("conversations").on("postgres_changes",{event:"INSERT",schema:"public",table:"conversations",filter:`participant1_id=eq.${s.id} OR participant2_id=eq.${s.id}`},(e=>{d()})).on("postgres_changes",{event:"UPDATE",schema:"public",table:"conversations",filter:`participant1_id=eq.${s.id} OR participant2_id=eq.${s.id}`},(e=>{d()})).subscribe();return()=>{ie.removeChannel(e)}}),[s,d]),D.useEffect((()=>{if(!s)return;const e=ie.channel("messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:"receiver_id=eq."+s.id},(e=>{x&&e.new.conversation_id===x.id&&g((s=>[...s,e.new])),d(),e.new.sender_id!==s.id&&t({title:"Nouveau message",description:"Vous avez reçu un nouveau message"})})).subscribe();return()=>{ie.removeChannel(e)}}),[s,x,d,t]);const Q=e=>m(null,null,(function*(){if(e){S(!0);try{const s=yield ne.getConversationMessages(e);g(s),yield ne.markMessagesAsRead(e),d()}catch(s){t({title:"Erreur",description:"Impossible de charger les messages",variant:"destructive"})}finally{S(!1)}}})),Z=()=>{if(!x||!s)return void t({title:"Erreur",description:"Impossible de déterminer la conversation ou l'utilisateur",variant:"destructive"});const e=x.participant1_id===s.id?x.participant2:x.participant1;e&&e.id?(G(e),q(!0),t({title:"Appel audio",description:"Initialisation de l'appel avec "+(e.first_name||e.last_name||"l'utilisateur")})):t({title:"Erreur",description:"Impossible de déterminer l'interlocuteur",variant:"destructive"})},Y=[...((null==r?void 0:r.filter((e=>{var t;return"unread"===b?null==(t=e.messages)?void 0:t.some((e=>!e.is_read&&e.sender_id!==(null==s?void 0:s.id))):"starred"===b?e.starred:"archived"!==b||e.is_archived})))||[]).filter((e=>{var s,t,a,r,i,n,l;if(!v)return!0;const o=v.toLowerCase(),c=`${(null==(s=e.participant1)?void 0:s.first_name)||""} ${(null==(t=e.participant1)?void 0:t.last_name)||""}`.toLowerCase(),d=`${(null==(a=e.participant2)?void 0:a.first_name)||""} ${(null==(r=e.participant2)?void 0:r.last_name)||""}`.toLowerCase();return!!(c.includes(o)||d.includes(o)||(null==(n=null==(i=e.listing)?void 0:i.title)?void 0:n.toLowerCase().includes(o))||(null==(l=e.messages)?void 0:l.some((e=>{var s;return null==(s=e.content)?void 0:s.toLowerCase().includes(o)}))))}))].sort(((e,s)=>{var t,a,r,i;const n=(null==(a=null==(t=e.messages)?void 0:t[e.messages.length-1])?void 0:a.created_at)||e.created_at,l=(null==(i=null==(r=s.messages)?void 0:r[s.messages.length-1])?void 0:i.created_at)||s.created_at;return n||l?n?l?new Date(l)-new Date(n):-1:1:0})),ee={total:(null==r?void 0:r.length)||0,unread:(null==r?void 0:r.filter((e=>{var t;return null==(t=e.messages)?void 0:t.some((e=>!e.is_read&&e.sender_id!==(null==s?void 0:s.id)))})).length)||0,starred:(null==r?void 0:r.filter((e=>e.starred)).length)||0,archived:(null==r?void 0:r.filter((e=>e.is_archived)).length)||0},se=e=>m(null,null,(function*(){try{const s=!e.starred;yield ne.toggleConversationStar(e.id,s),d()}catch(s){t({title:"Erreur",description:"Impossible de modifier le statut favori",variant:"destructive"})}})),te=e=>m(null,null,(function*(){try{yield ne.archiveConversation(e.id),d()}catch(s){t({title:"Erreur",description:"Impossible d'archiver la conversation",variant:"destructive"})}})),ae=e=>{L(e),E(!0)},oe=()=>{_(new Set),$(!1)};return l?u.jsx("div",{className:"flex items-center justify-center h-96",children:u.jsxs("div",{className:"text-center",children:[u.jsx(pe,{className:"mx-auto h-12 w-12 text-destructive mb-4"}),u.jsx("h3",{className:"text-lg font-medium text-card-foreground mb-2",children:"Erreur de chargement"}),u.jsx("p",{className:"text-muted-foreground mb-4",children:l.message||"Impossible de charger les conversations"}),u.jsx(J,{onClick:()=>d(),className:"bg-blue-600 hover:bg-blue-700",children:"Réessayer"})]})}):u.jsxs("div",{className:"h-screen bg-background flex flex-col overflow-hidden max-h-screen",children:[!x&&u.jsx(Gs,{selectedConversation:x,onBack:()=>p(null),onMenuToggle:()=>w(!y),onSearch:()=>w(!1),onFilter:()=>w(!1),onMore:()=>{},onCall:Z,onVideo:()=>{},unreadCount:ee.unread}),!x&&u.jsx("div",{className:"bg-card border-b border-border px-6 py-4 hidden md:block flex-shrink-0",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("h1",{className:"text-2xl font-bold text-card-foreground",children:"Centre de Messages"}),u.jsx("p",{className:"text-muted-foreground",children:"Gérez vos conversations et échangez avec d'autres utilisateurs"})]}),u.jsx("div",{className:"flex items-center space-x-3",children:u.jsxs(J,{className:"bg-primary hover:bg-primary/90",children:[u.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Nouvelle Conversation"]})})]})}),u.jsxs("div",{className:"flex flex-1 overflow-hidden min-h-0",children:[u.jsxs("div",{className:`\n          ${x?"hidden md:block":"block"} \n          w-full md:w-80 lg:w-96 \n          bg-card border-r border-border \n          flex flex-col\n        `,children:[u.jsx(Hs,{searchTerm:v,onSearchChange:j,filterType:b,onFilterChange:N,onClear:()=>j(""),totalCount:ee.total,unreadCount:ee.unread,starredCount:ee.starred,archivedCount:ee.archived}),u.jsx("div",{className:"flex-1 overflow-y-auto",children:i?u.jsx("div",{className:"p-4 space-y-3",children:[...[,,,,,]].map(((e,s)=>u.jsx("div",{className:"animate-pulse",children:u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx("div",{className:"w-10 h-10 bg-muted rounded-full"}),u.jsxs("div",{className:"flex-1",children:[u.jsx("div",{className:"h-4 bg-muted rounded w-3/4 mb-2"}),u.jsx("div",{className:"h-3 bg-muted rounded w-1/2"})]})]})},s)))}):0===Y.length?u.jsxs("div",{className:"p-8 text-center",children:[u.jsx(pe,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),u.jsx("h3",{className:"text-lg font-medium text-card-foreground mb-2",children:"Aucune conversation"}),u.jsx("p",{className:"text-muted-foreground",children:v?"Aucune conversation trouvée pour votre recherche":"Commencez une nouvelle conversation"})]}):u.jsx("div",{className:"space-y-1",children:Y.map((e=>u.jsx(lt,{conversation:e,isSelected:(null==x?void 0:x.id)===e.id,onSelect:()=>(e=>m(null,null,(function*(){p(e),Q(e.id),w(!1);try{yield ne.markMessagesAsRead(e.id),d()}catch(s){}})))(e),onMarkAsRead:()=>(e=>m(null,null,(function*(){try{yield ne.markMessagesAsRead(e.id),d()}catch(s){t({title:"Erreur",description:"Impossible de marquer les messages comme lus",variant:"destructive"})}})))(e),onToggleStar:()=>se(e),onArchive:()=>te(e),onDelete:()=>ae(e),currentUserId:null==s?void 0:s.id},e.id)))})})]}),x?u.jsxs("div",{className:"flex-1 flex flex-col bg-card min-h-0",children:[u.jsx("div",{className:"border-b border-border p-4 flex-shrink-0",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx(J,{variant:"ghost",size:"sm",onClick:()=>p(null),className:"p-2 -ml-2 md:hidden",children:u.jsx(X,{className:"h-5 w-5"})}),u.jsx(Us,{user:x.participant1_id===(null==s?void 0:s.id)?x.participant2:x.participant1,size:"default"}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-medium",children:(()=>{const e=x.participant1_id===(null==s?void 0:s.id)?x.participant2:x.participant1;return e&&`${e.first_name||""} ${e.last_name||""}`.trim()||"Utilisateur"})()}),u.jsx("p",{className:"text-sm text-muted-foreground",children:(null==(e=x.listing)?void 0:e.title)||"Conversation"})]})]}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(J,{variant:"ghost",size:"sm",onClick:Z,children:u.jsx(le,{className:"h-4 w-4"})}),u.jsxs(Ge,{children:[u.jsx(He,{asChild:!0,children:u.jsx(J,{variant:"ghost",size:"sm",children:u.jsx(ce,{className:"h-4 w-4"})})}),u.jsxs(We,{align:"end",className:"w-48",children:[u.jsxs(Ke,{onClick:()=>se(x),children:[u.jsx(V,{className:"h-4 w-4 mr-2"}),x.starred?"Retirer des favoris":"Ajouter aux favoris"]}),u.jsxs(Ke,{onClick:()=>te(x),children:[u.jsx(ge,{className:"h-4 w-4 mr-2"}),x.is_archived?"Désarchiver":"Archiver"]}),u.jsx(Qe,{}),u.jsxs(Ke,{onClick:()=>ae(x),className:"text-destructive focus:text-destructive",children:[u.jsx(O,{className:"h-4 w-4 mr-2"}),"Supprimer la conversation"]})]})]})]})]})}),u.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 min-h-0",children:[P&&u.jsx("div",{className:"sticky top-0 bg-card border border-border rounded-lg p-3 mb-4 shadow-sm z-10",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsxs("span",{className:"text-sm font-medium text-foreground",children:[I.size," message(s) sélectionné(s)"]}),u.jsxs("div",{className:"flex space-x-2",children:[u.jsx(J,{variant:"outline",size:"sm",onClick:()=>{const e=f.map((e=>e.id));_(new Set(e))},className:"text-xs",children:"Tout sélectionner"}),u.jsx(J,{variant:"outline",size:"sm",onClick:()=>{const e=f.filter((e=>e.sender_id===(null==s?void 0:s.id))).map((e=>e.id));_(new Set(e))},className:"text-xs",children:"Mes messages"})]})]}),u.jsxs("div",{className:"flex space-x-2",children:[u.jsx(J,{variant:"outline",size:"sm",onClick:oe,className:"text-xs",children:"Annuler"}),u.jsxs(J,{variant:"destructive",size:"sm",onClick:()=>{I.size},className:"text-xs",disabled:0===I.size,children:["Supprimer (",I.size,")"]})]})]})}),!P&&f.length>0&&u.jsxs("div",{className:"text-center text-xs text-muted-foreground mb-4 p-2 bg-muted/30 rounded-lg",children:["💡 ",u.jsx("strong",{children:"Appui long"})," sur un message pour activer la sélection multiple"]}),C?u.jsx("div",{className:"flex items-center justify-center h-full",children:u.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):0===f.length?u.jsx("div",{className:"text-center text-muted-foreground",children:u.jsx("p",{children:"Aucun message dans cette conversation"})}):f.map((e=>u.jsx(ot,{message:e,isOwn:e.sender_id===(null==s?void 0:s.id),participant1:x.participant1,participant2:x.participant2,currentUserId:null==s?void 0:s.id,onLongPress:()=>{return s=e.id,$(!0),void _(new Set([s]));var s},onPress:()=>{return s=e.id,void(P&&(e=>{P&&_((s=>{const t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t}))})(s));var s},isSelected:I.has(e.id),isSelectionMode:P},e.id)))]}),u.jsx("div",{className:"flex-shrink-0 relative z-10",children:u.jsx(at,{value:k,onChange:e=>z(e.target.value),onSend:e=>m(null,null,(function*(){if(e.trim()&&x)try{const s=yield ne.sendMessage(x.id,e.trim());z(""),g((e=>[...e,s])),d()}catch(s){t({title:"Erreur",description:"Impossible d'envoyer le message",variant:"destructive"})}})),onAttachment:e=>{},onEmoji:()=>{},onVoice:()=>{},onCamera:()=>{},placeholder:"Tapez votre message...",disabled:C})})]}):u.jsx("div",{className:"hidden md:flex flex-1 items-center justify-center bg-muted/50",children:u.jsxs("div",{className:"text-center",children:[u.jsx(pe,{className:"mx-auto h-16 w-16 text-muted-foreground mb-4"}),u.jsx("h3",{className:"text-xl font-medium text-card-foreground mb-2",children:"Sélectionnez une conversation"}),u.jsx("p",{className:"text-muted-foreground",children:"Choisissez une conversation dans la liste pour commencer à échanger"})]})})]}),A&&R&&u.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:u.jsxs("div",{className:"bg-card p-6 rounded-lg max-w-md w-full mx-4",children:[u.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Confirmer la suppression"}),u.jsx("p",{className:"text-muted-foreground mb-6",children:"Êtes-vous sûr de vouloir supprimer définitivement cette conversation ? Cette action ne peut pas être annulée."}),u.jsxs("div",{className:"flex space-x-3",children:[u.jsx(J,{variant:"outline",onClick:()=>E(!1),className:"flex-1",children:"Annuler"}),u.jsx(J,{variant:"destructive",onClick:()=>{var e;e=R,(null==x?void 0:x.id)===e.id&&(p(null),g([])),K.mutate(e.id),E(!1),L(null)},className:"flex-1",disabled:K.isLoading,children:K.isLoading?"Suppression...":"Supprimer"})]})]})}),P&&I.size>0&&u.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:u.jsxs("div",{className:"bg-card p-6 rounded-lg max-w-md w-full mx-4",children:[u.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Confirmer la suppression"}),u.jsxs("p",{className:"text-muted-foreground mb-6",children:["Êtes-vous sûr de vouloir supprimer définitivement ",I.size," message(s) ? Cette action ne peut pas être annulée."]}),u.jsxs("div",{className:"flex space-x-3",children:[u.jsx(J,{variant:"outline",onClick:oe,className:"flex-1",children:"Annuler"}),u.jsxs(J,{variant:"destructive",onClick:()=>m(null,null,(function*(){if(0!==I.size)try{const e=Array.from(I).map((e=>ne.deleteMessage(e)));yield Promise.all(e),g((e=>e.filter((e=>!I.has(e.id))))),oe(),t({title:"Messages supprimés",description:I.size+" message(s) supprimé(s) avec succès"})}catch(e){t({title:"Erreur",description:"Impossible de supprimer certains messages",variant:"destructive"})}})),className:"flex-1",children:["Supprimer (",I.size,")"]})]})]})}),U&&B&&u.jsx(tt,{isOpen:U,onClose:()=>{q(!1),G(null)},targetUser:B,currentUser:s,roomId:`call-${null==s?void 0:s.id}-${B.id}`})]})},lt=({conversation:e,isSelected:s,onSelect:t,onMarkAsRead:a,onToggleStar:r,onArchive:i,onDelete:n,currentUserId:l})=>{var o,c,d;const m=null==(o=e.messages)?void 0:o[e.messages.length-1],h=null==(c=e.messages)?void 0:c.some((e=>!e.is_read&&e.sender_id!==l)),x=e.participant1_id===l?e.participant2:e.participant1,p="00000000-0000-0000-0000-000000000000"===e.participant1_id||"00000000-0000-0000-0000-000000000000"===e.participant2_id;return u.jsxs("div",{className:`\n        group p-4 cursor-pointer transition-colors hover:bg-accent relative\n        ${s?"bg-primary/10 border-r-2 border-primary":""}\n        ${h?"bg-primary/10":""}\n        ${p?"bg-gradient-to-r from-blue-50 to-purple-50 border-l-4 border-blue-500":""}\n      `,onClick:t,children:[p&&u.jsx("div",{className:"absolute top-2 right-2",children:u.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white text-xs px-2 py-1 rounded-full font-medium shadow-sm",children:"🤖 Assistant"})}),u.jsxs("div",{className:"flex items-start space-x-3",children:[u.jsxs("div",{className:"relative",children:[p?u.jsx(rt,{size:"default",className:"flex-shrink-0"}):u.jsx(Us,{user:x,size:"default",className:"flex-shrink-0"}),h&&u.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-primary rounded-full"})]}),u.jsxs("div",{className:"flex-1 min-w-0",children:[u.jsxs("div",{className:"flex items-center justify-between mb-1",children:[u.jsx("h4",{className:"font-medium text-sm truncate",children:p?"AIDA":x&&`${x.first_name||""} ${x.last_name||""}`.trim()||"Utilisateur"}),u.jsxs("div",{className:"flex items-center space-x-2",children:[e.starred&&u.jsx(V,{className:"h-3 w-3 text-yellow-500 fill-current"}),u.jsx("span",{className:"text-xs text-muted-foreground",children:(null==m?void 0:m.created_at)?(e=>{if(!e)return"À l'instant";try{const s=new Date(e),t=new Date,a=Math.floor((t-s)/36e5),r=Math.floor((t-s)/864e5);return 1>a?"À l'instant":24>a?`Il y a ${a}h`:7>r?`Il y a ${r}j`:s.toLocaleDateString("fr-FR",{day:"numeric",month:"short"})}catch(s){return"À l'instant"}})(m.created_at):"À l'instant"})]})]}),u.jsx("p",{className:"text-sm text-muted-foreground truncate mb-1",children:(null==m?void 0:m.content)||"Aucun message"}),u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx("span",{className:"text-xs text-muted-foreground",children:p?"Support et assistance":(null==(d=e.listing)?void 0:d.title)||"Conversation"}),u.jsx("div",{className:"flex items-center space-x-1",children:h&&u.jsx(de,{variant:"destructive",className:"h-5 px-2 text-xs",children:"Nouveau"})})]})]}),u.jsx("div",{className:"flex-shrink-0",onClick:e=>e.stopPropagation(),children:u.jsxs(Ge,{children:[u.jsx(He,{asChild:!0,children:u.jsx(J,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:u.jsx(ce,{className:"h-4 w-4"})})}),u.jsxs(We,{align:"end",className:"w-48",children:[u.jsxs(Ke,{onClick:()=>null==a?void 0:a(e),children:[u.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Marquer comme lu"]}),u.jsxs(Ke,{onClick:()=>null==r?void 0:r(e),children:[u.jsx(V,{className:"h-4 w-4 mr-2"}),e.starred?"Retirer des favoris":"Ajouter aux favoris"]}),u.jsxs(Ke,{onClick:()=>null==i?void 0:i(e),children:[u.jsx(ge,{className:"h-4 w-4 mr-2"}),e.is_archived?"Désarchiver":"Archiver"]}),u.jsx(Qe,{}),u.jsxs(Ke,{onClick:()=>null==n?void 0:n(e),className:"text-destructive focus:text-destructive",children:[u.jsx(O,{className:"h-4 w-4 mr-2"}),"Supprimer"]})]})]})})]})]})},ot=({message:e,isOwn:s,participant1:t,participant2:a,currentUserId:r,onLongPress:i,onPress:n,isSelected:l=!1,isSelectionMode:o=!1})=>{const[c,d]=D.useState(null),m="00000000-0000-0000-0000-000000000000"===e.sender_id,h=e.sender_id===(null==t?void 0:t.id)?t:a;return u.jsxs("div",{className:`flex ${s?"justify-end":"justify-start"} space-x-2`,onTouchStart:()=>{if(i){const e=setTimeout((()=>{i()}),500);d(e)}},onTouchEnd:()=>{c&&(clearTimeout(c),d(null))},onClick:()=>{n&&n()},children:[!s&&(m?u.jsx(rt,{size:"sm",className:"flex-shrink-0 mt-1"}):u.jsx(Us,{user:h,size:"sm",className:"flex-shrink-0 mt-1"})),u.jsxs("div",{className:`\n        relative max-w-xs lg:max-w-md px-4 py-2 rounded-lg cursor-pointer\n        transition-all duration-200\n        ${s?"bg-primary text-primary-foreground":m?"bg-gradient-to-r from-blue-100 to-purple-100 text-gray-800 border border-blue-200":"bg-muted text-muted-foreground"}\n        ${l?"ring-2 ring-primary ring-offset-2":""}\n        ${o?"hover:ring-2 hover:ring-primary/50":""}\n      `,children:[l&&u.jsx("div",{className:"absolute -top-2 -right-2 w-5 h-5 bg-primary rounded-full flex items-center justify-center",children:u.jsx("span",{className:"text-primary-foreground text-xs",children:"✓"})}),u.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[!s&&m&&u.jsx("span",{className:"text-xs font-medium text-blue-600",children:"🤖 AIDA"}),u.jsx("span",{className:"text-xs opacity-75",children:(e=>{if(!e)return"À l'instant";try{return new Date(e).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}catch(s){return"À l'instant"}})(e.created_at)})]}),u.jsx("p",{className:"text-sm",children:e.content})]}),s&&u.jsx(Us,{user:{first_name:"Moi",last_name:""},size:"sm",className:"flex-shrink-0 mt-1"})]})},ct=Object.freeze(Object.defineProperty({__proto__:null,default:()=>u.jsx(is,{client:it,children:u.jsx(nt,{})})},Symbol.toStringTag,{value:"Module"}));export{Bs as A,Rs as B,vs as C,zs as D,As as E,Ms as L,ct as M,_s as P,Es as R,Os as S,hs as T,Us as U,ps as a,fs as b,gs as c,ws as d,Ss as e,Ts as f,Ps as g,js as h,bs as i,Ns as j,ys as k,qs as t};
