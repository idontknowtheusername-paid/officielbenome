import{j as s}from"./ui-BkW4XaSf.js";import{r as e}from"./router-g3RhsYON.js";import{av as r,aw as a,ax as t,w as i,B as n,R as c,az as o,s as l,a_ as m,D as u,o as d}from"./admin-CLRj9nsH.js";import{u as x}from"./messaging-BtZ3PSY-.js";import"./vendor-DaBoii6j.js";import"./animations-B7Vm-81o.js";import"./query-BZBOCxXK.js";import"./utils-iFD8Ag1C.js";import"./charts-B6pUC4mM.js";import"./forms-CVlSZARz.js";import"./supabase-CS--z241.js";import"./services-CqmL7Hwe.js";import"./maps-DILUY6PO.js";const g=()=>{const{user:g,session:j}=x(),[h,p]=e.useState({}),[f,v]=e.useState(!1),N=()=>{return s=function*(){v(!0);const s={};try{const{data:r,error:a}=yield l.from("conversations").select("count").limit(1);s.supabaseConnection={status:a?"error":"success",message:a?"Erreur: "+a.message:"Connexion OK",details:a},s.authentication={status:g?"success":"error",message:g?"Utilisateur connecté: "+g.email:"Aucun utilisateur connecté",details:{user:g,session:j}};const t=void 0,i=void 0;if(s.environment={status:t&&i?"success":"error",message:t&&i?"Variables configurées":"Variables manquantes",details:{url:t?"✅ Configurée":"❌ Manquante",key:i?"✅ Configurée":"❌ Manquante"}},g)try{const{data:e,error:r}=yield l.from("conversations").select("*").or(`participant1_id.eq.${g.id},participant2_id.eq.${g.id}`).limit(5);s.conversations={status:r?"error":"success",message:r?"Erreur: "+r.message:((null==e?void 0:e.length)||0)+" conversations trouvées",details:r}}catch(e){s.conversations={status:"error",message:"Erreur: "+e.message,details:e}}if(g)try{const{data:e,error:r}=yield l.from("messages").select("*").or(`sender_id.eq.${g.id},receiver_id.eq.${g.id}`).limit(5);s.messages={status:r?"error":"success",message:r?"Erreur: "+r.message:((null==e?void 0:e.length)||0)+" messages trouvés",details:r}}catch(e){s.messages={status:"error",message:"Erreur: "+e.message,details:e}}}catch(e){s.general={status:"error",message:"Erreur générale: "+e.message,details:e}}p(s),v(!1)},new Promise(((e,r)=>{var a=e=>{try{i(s.next(e))}catch(a){r(a)}},t=e=>{try{i(s.throw(e))}catch(a){r(a)}},i=s=>s.done?e(s.value):Promise.resolve(s.value).then(a,t);i((s=s.apply(null,null)).next())}));var s};e.useEffect((()=>{N()}),[g]);const w=e=>{switch(e){case"success":return s.jsx(u,{className:"h-4 w-4 text-green-500"});case"error":return s.jsx(m,{className:"h-4 w-4 text-red-500"});default:return s.jsx(i,{className:"h-4 w-4 text-yellow-500"})}},y=e=>{switch(e){case"success":return s.jsx(d,{variant:"default",className:"bg-green-500",children:"OK"});case"error":return s.jsx(d,{variant:"destructive",children:"ERREUR"});default:return s.jsx(d,{variant:"secondary",children:"WARNING"})}};return s.jsx("div",{className:"p-6 max-w-4xl mx-auto",children:s.jsxs(r,{children:[s.jsxs(a,{children:[s.jsxs(t,{className:"flex items-center gap-2",children:[s.jsx(i,{className:"h-5 w-5"}),"Diagnostic Interface Messagerie"]}),s.jsx(n,{onClick:N,disabled:f,className:"w-fit",children:f?s.jsxs(s.Fragment,{children:[s.jsx(c,{className:"h-4 w-4 mr-2 animate-spin"}),"Diagnostic en cours..."]}):s.jsxs(s.Fragment,{children:[s.jsx(c,{className:"h-4 w-4 mr-2"}),"Relancer le diagnostic"]})})]}),s.jsx(o,{className:"space-y-4",children:Object.entries(h).map((([e,r])=>s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h3",{className:"font-medium capitalize",children:e.replace(/([A-Z])/g," $1")}),s.jsxs("div",{className:"flex items-center gap-2",children:[w(r.status),y(r.status)]})]}),s.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:r.message}),r.details&&s.jsxs("details",{className:"text-xs",children:[s.jsx("summary",{className:"cursor-pointer text-muted-foreground",children:"Détails techniques"}),s.jsx("pre",{className:"mt-2 p-2 bg-muted rounded text-xs overflow-auto",children:JSON.stringify(r.details,null,2)})]})]},e)))})]})})},j=()=>s.jsx("div",{className:"min-h-screen bg-background",children:s.jsx(g,{})});export{j as default};
